<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-deep-dives/specifications/client-sdk-states-and-lifecycle" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Client SDK States &amp; Lifecycle | Experimenter Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://experimenter.info/client-sdk-states-and-lifecycle"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Client SDK States &amp; Lifecycle | Experimenter Docs"><meta data-rh="true" name="description" content="Nimbus SDK Experiment States and Lifecycle"><meta data-rh="true" property="og:description" content="Nimbus SDK Experiment States and Lifecycle"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://experimenter.info/client-sdk-states-and-lifecycle"><link data-rh="true" rel="alternate" href="https://experimenter.info/client-sdk-states-and-lifecycle" hreflang="en"><link data-rh="true" rel="alternate" href="https://experimenter.info/client-sdk-states-and-lifecycle" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.bb172d27.css">
<link rel="preload" href="/assets/js/runtime~main.3f33d2ba.js" as="script">
<link rel="preload" href="/assets/js/main.a8034749.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Mozilla Experimentation and Feature Delivery</b></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Nimbus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://mozilla-hub.atlassian.net/wiki/spaces/PXI/pages/426934273/Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Confluence<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/">Welcome</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/whats-news/2024-Q1">What&#x27;s Newsletter</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/access">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/workflow/overview">Experimentation Workflow</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/deep-dives/jetstream/overview">Deep Dives</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/deep-dives/jetstream/overview">Jetstream</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/bucketing">Data topics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/desktop-enroll-locally">Desktop topics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mobile-behavioral-targeting">Mobile topics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/deep-dives/experimenter/branches-page">Experimenter topics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/client-sdk-states-and-lifecycle">Specifications</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/client-sdk-states-and-lifecycle">Client SDK States &amp; Lifecycle</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fml-spec">Feature Manifest Language</a></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cookbook/fml/fml-cookbook">Experimentation Cookbook</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/faq/general-faq">FAQ</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/integration-tests">Additional Links</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deep Dives</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Specifications</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Client SDK States &amp; Lifecycle</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Client SDK States &amp; Lifecycle</h1></header><p>Nimbus SDK Experiment States and Lifecycle</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="authors-ryan-kelly">Authors: Ryan Kelly<a href="#authors-ryan-kelly" class="hash-link" aria-label="Direct link to Authors: Ryan Kelly" title="Direct link to Authors: Ryan Kelly">​</a></h6><h6 class="anchor anchorWithStickyNavbar_LWe7" id="reviewers-kate-hudson-tim-smith">Reviewers: Kate Hudson, Tim Smith<a href="#reviewers-kate-hudson-tim-smith" class="hash-link" aria-label="Direct link to Reviewers: Kate Hudson, Tim Smith" title="Direct link to Reviewers: Kate Hudson, Tim Smith">​</a></h6><h6 class="anchor anchorWithStickyNavbar_LWe7" id="status-draft-as-of-november-2020-see-the-changelog-for-updates">Status: Draft as of November 2020; see the <a href="#changelog">changelog</a> for updates<a href="#status-draft-as-of-november-2020-see-the-changelog-for-updates" class="hash-link" aria-label="Direct link to status-draft-as-of-november-2020-see-the-changelog-for-updates" title="Direct link to status-draft-as-of-november-2020-see-the-changelog-for-updates">​</a></h6><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>This document provides a high-level overview of the lifecycle of a Nimbus experiment, from the point of view of the client SDK. It&#x27;s in part an adjunct to the <a href="https://github.com/mozilla/experimenter/tree/main/app/experimenter/kinto#experiment-states" target="_blank" rel="noopener noreferrer">Nimbus Experiment Publishing Lifecycle</a>.</p><p>The <a href="#client-behaviors">behaviour of API calls</a> to the Client SDK will
depend on both the last observed <a href="#server-side-experiment-states">server-side experiment
state</a>, and the current <a href="#client-side-experiment-states">local client
state</a>, and the SDK will <a href="#telemetry">emit
telemetry</a> based on the local state of each
experiment.</p><p>I happen to think that these states could map nicely to some Rust Enums, but your mileage may vary.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-concepts">Key Concepts<a href="#key-concepts" class="hash-link" aria-label="Direct link to Key Concepts" title="Direct link to Key Concepts">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="treatment">Treatment<a href="#treatment" class="hash-link" aria-label="Direct link to Treatment" title="Direct link to Treatment">​</a></h4><p>We&#x27;ll use &quot;treatment&quot; to refer to the change in client behaviour that&#x27;s triggered by an experiment. This might be a small change in colour or wording, or may provide some much larger piece of new UX. The details and scope don&#x27;t matter for our purposes here, what matters is having a word that means &quot;the user is experiencing the effects of the experiment&quot;.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="enrollment">Enrollment<a href="#enrollment" class="hash-link" aria-label="Direct link to Enrollment" title="Direct link to Enrollment">​</a></h4><p>Enrollment is the process of the client SDK deciding whether this client should be part of the experiment and if so, what branch it should be assigned to. We&#x27;ll emit an <a href="https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11469458/Nimbus+Engineering#NimbusEngineering-ExperimentTelemetry" target="_blank" rel="noopener noreferrer">enrollment</a> telemetry event when this happens.</p><p>Once a client is enrolled in an experiment, it will tag its telemetry pings with that experiment and branch information so that they can be identified for analysis.</p><p>Enrolled clients will remain enrolled and assigned to the same branch until the experiment ends, or until they reset their experiment state by disabling telemetry. A client may <em>disable the treatment</em> under various circumstances, but it&#x27;s important that it continue reporting that it was enrolled in the experiment, to <a href="https://docs.google.com/document/d/18Vdn4zZX2D1u9AqzHRY0lUSUbpBdouqWtVp3Bu8vYQA/" target="_blank" rel="noopener noreferrer">help with data analysis</a>.</p><p>Note that it&#x27;s possible for an experiment to be closed for new enrollments, while continuing to be active for and showing its treatment to previously-enrolled clients.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="exposure">Exposure<a href="#exposure" class="hash-link" aria-label="Direct link to Exposure" title="Direct link to Exposure">​</a></h4><p>Exposure is the process of actually showing the treatment. In other words, it&#x27;s when we change client behaviour based on the experiment branch in which the client was enrolled, or when we <em>would</em> have changed behaviour if the user was not in the control group. We&#x27;ll emit an <a href="https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11469458/Nimbus+Engineering#NimbusEngineering-ExperimentTelemetry" target="_blank" rel="noopener noreferrer">exposure</a> telemetry event the first time this happens.</p><p>Note that it&#x27;s possible for a client to be enrolled in an experiment but never be exposed to its treatment, for example if the user never uses the part of the client app that is affected by the treatment.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disqualification">Disqualification<a href="#disqualification" class="hash-link" aria-label="Direct link to Disqualification" title="Direct link to Disqualification">​</a></h4><p>After a client is enrolled in an experiment, we may need to disable that experiment&#x27;s treatment for various reasons, such as:</p><ul><li>The user explicitly opts out of the experiment, or of all experiments.</li><li>The application code detects that it cannot show the treatment.</li><li>The targeting parameters change in a way that excludes the client.</li></ul><p>We&#x27;ll emit a telemetry event when this happens.</p><p>Importantly, if the client was already enrolled in an experiment, then it will continue to tag its telemetry pings with the enrolled experiment and branch information, even if it has become disqualified.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="server-side-experiment-states">Server-Side Experiment States<a href="#server-side-experiment-states" class="hash-link" aria-label="Direct link to Server-Side Experiment States" title="Direct link to Server-Side Experiment States">​</a></h2><p>The Nimbus experiment publishing workflow moves each experiment through several different states, reflected in the experiment data published to the Remote Settings server. Transitions between the states are triggered by updates published to Remote Settings. (TODO: maybe also by the passage of time as observed by the RS server?)</p><p>Note that we are only interested in states that are observable by the client; the experiment publishing workflow has additional states for internal use that are not represented here.</p><p><img loading="lazy" alt="drawing" src="/assets/images/client-visible-publishing-workflow-states-e5f4250300351875d43b86546828e0de.png" width="448" height="428" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-preparing-state">The &quot;Preparing&quot; State<a href="#the-preparing-state" class="hash-link" aria-label="Direct link to The &quot;Preparing&quot; State" title="Direct link to The &quot;Preparing&quot; State">​</a></h4><p>Before an experiment becomes visible to clients in Remote Settings, it may go through a series of drafts and adjustments and approvals in the Experimenter console. This is represented in the server-side workflow by several different states, but since it is completely invisible to the Client SDK these will not be discussed further in this document.</p><p>Transitions:</p><ul><li>To <strong>Enrolling</strong> state, by being made visible to clients in Remote Settings.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-enrolling-state">The &quot;Enrolling&quot; State<a href="#the-enrolling-state" class="hash-link" aria-label="Direct link to The &quot;Enrolling&quot; State" title="Direct link to The &quot;Enrolling&quot; State">​</a></h4><p>This is the first phase of an experiment going &quot;live&quot; and starting to show up in the user experience. It&#x27;s indicated by the experiment being visible to clients in Remote Settings with <em>isEnrollmentPaused</em> set to <em>false</em>.</p><p>Clients that <em>observe an experiment transition</em> to this state should check whether to enroll in the experiment (N.B. this includes a self-transition from <strong>Enrolling</strong> -&gt; <strong>Enrolling</strong> that is accompanied by a change in the published experiment config, which might change enrollment decisions).</p><p>While the experiment is in this state, enrolled clients should activate the experiment treatment appropriate for their enrolled branch, and report telemetry about it.</p><p>Transitions:</p><ul><li>To <strong>Running</strong> state, when a Remote Settings update changes <em>isEnrollmentPaused</em> to <em>true</em>.</li><li>To <strong>Enrolling</strong> state, when a Remote Settings update changes other experiment parameters.</li><li>To <strong>Ended</strong> state, if the experiment ceases to be visible in Remote Settings.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-running-state">The &quot;Running&quot; State<a href="#the-running-state" class="hash-link" aria-label="Direct link to The &quot;Running&quot; State" title="Direct link to The &quot;Running&quot; State">​</a></h4><p>This is the second phase of an experiment being live and showing up in the user experience. It&#x27;s indicated by the experiment being visible to clients in Remote Settings with <em>isEnrollmentPaused</em> set to <em>true</em>.</p><p>While the experiment is in this state, clients that are <em>not</em> already enrolled in the experiment should not enroll themselves, even if the experiment config changes in a way that would otherwise cause them to enroll. Already-enrolled clients should continue to activate the experiment treatment appropriate for their enrolled branch, and report telemetry about it.</p><p>Transitions:</p><ul><li>To <strong>Enrolling</strong> state, when a Remote Settings update changes <em>isEnrollmentPaused</em> to <em>false</em>.</li><li>To <strong>Running</strong> state, when a Remote Settings update changes other experiment parameters.</li><li>To <strong>Ended</strong> state, if the experiment ceases to be visible in Remote Settings.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-ended-state">The &quot;Ended&quot; State<a href="#the-ended-state" class="hash-link" aria-label="Direct link to The &quot;Ended&quot; State" title="Direct link to The &quot;Ended&quot; State">​</a></h4><p>An experiment ends when it ceases to be visible to clients in Remote Settings. As with the &quot;Preparing&quot; state, there may be multiple server-side states involved in ending an experiment, but since they are completely invisible to the Client SDK these will not be discussed further in this document.</p><p>Transitions:</p><ul><li>None, this state is terminal.</li></ul><p>Errors:</p><ul><li>TODO: should we log some sort of error if we observe an experiment coming back to life after it was ended?</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-side-experiment-states">Client-Side Experiment States<a href="#client-side-experiment-states" class="hash-link" aria-label="Direct link to Client-Side Experiment States" title="Direct link to Client-Side Experiment States">​</a></h2><p>Each Nimbus client will also have its own local state for each experiment, based on the observed history of the server-side experiment states that it has read from the Remote Settings server. Transitions between the states are triggered by observing experiment config changes when querying the Remote Settings server, and by the passage of time on the client.</p><p><img loading="lazy" alt="client-side local states" src="data:image/png;base64,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" width="366" height="388" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-unknown-state">The &quot;Unknown&quot; State<a href="#the-unknown-state" class="hash-link" aria-label="Direct link to The &quot;Unknown&quot; State" title="Direct link to The &quot;Unknown&quot; State">​</a></h4><p>Before an experiment is published to Remote Settings, obviously the client SDK can&#x27;t know anything about it. But there may be client code that calls the SDK asking whether to activate treatments for this as-yet-unknown experiment, so it&#x27;s worth representing this state explicitly.</p><p>Transitions:</p><ul><li>To <strong>Enrolled</strong> state,  by observing the experiment in Remote Settings for the first time, the experiment being in <strong>Enrolling</strong> state, and bucketing logic dictating that the client should enroll in a branch of the experiment.</li><li>To <strong>NotEnrolled</strong> state, by observing the experiment in Remote Settings for the first time, but deciding not to enroll based on the observed experiment state or local config.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-notenrolled-state">The &quot;NotEnrolled&quot; State<a href="#the-notenrolled-state" class="hash-link" aria-label="Direct link to The &quot;NotEnrolled&quot; State" title="Direct link to The &quot;NotEnrolled&quot; State">​</a></h4><p>In this state, the client has observed the existence of an experiment in Remote Settings and has stored a local copy of the current experiment config, but based on that config has decided not to enroll in the experiment.</p><p>Transitions:</p><ul><li>To <strong>Enrolled</strong> state, when the experiment transitions to <strong>Enrolling</strong> state, and bucketing logic dictates that the client should enroll in a branch of the experiment.<ul><li>(N.B. this includes the experiment transitioning <strong>Enrolling</strong> -&gt; <strong>Enrolling</strong> with an update to the experiment config)</li><li>(N.B. the bucketing logic may depend on the state of other experiments, in the case of conflicts between multiple experiments)</li></ul></li><li>To <strong>Errored</strong> state, encountering some unrecoverable error in the experiment config.</li><li>To <strong>Discarded</strong> state, when the experiment transitions to <strong>Cancelled</strong> or <strong>Completed</strong>.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-enrolled-state">The &quot;Enrolled&quot; State<a href="#the-enrolled-state" class="hash-link" aria-label="Direct link to The &quot;Enrolled&quot; State" title="Direct link to The &quot;Enrolled&quot; State">​</a></h4><p>In this state, the client has previously observed the experiment in <strong>Enrolling</strong> state and has been bucketed into a branch of the experiment. It persists the selected branch so that it can consistently reference it even if the experiment config changes in future.</p><p>Transitions:</p><ul><li>To <strong>Disqualified</strong> state:<ul><li>When the user explicitly opts out of participating in this experiment.</li><li>When the user explicitly opts out of participating in experiments in general.</li><li>When application code makes an explicit API call to disable this experiment.</li><li>When the experiment transitions to <strong>Enrolling</strong> or <strong>Running</strong> state, and its targeting expression no longer matches the client.<ul><li>(N.B. this includes the experiment transitioning <strong>Enrolling</strong> -&gt; <strong>Enrolling</strong> with an update to the experiment config, which can re-trigger bucketing evaluation)</li></ul></li><li>When encountering some unrecoverable error in the experiment config.</li></ul></li><li>To <strong>WasEnrolled</strong> state:<ul><li>When the experiment transitions to <strong>Cancelled</strong> or <strong>Completed</strong><ul><li>(i.e. When a valid response is received from Remote Settings and the experiment is no longer present in the Remote Settings collection).</li></ul></li></ul></li><li>To <strong>Discarded</strong> state, when the user entirely disables telemetry in their client.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-disqualified-state">The &quot;Disqualified&quot; State<a href="#the-disqualified-state" class="hash-link" aria-label="Direct link to The &quot;Disqualified&quot; State" title="Direct link to The &quot;Disqualified&quot; State">​</a></h4><p>In this state, the client had previously enrolled in the experiment, but some change has occurred that means we can no longer show them to experiment treatment. The client will continue to tag its telemetry pings with enrollment data, but will not activate the treatment.</p><p>Transitions:</p><ul><li>To <strong>WasEnrolled</strong> state:<ul><li>When the experiment transitions to <strong>Cancelled</strong> or <strong>Completed</strong><ul><li>(i.e. When a valid response is received from Remote Settings and the experiment is no longer present in the Remote Settings collection).</li></ul></li></ul></li><li>To <strong>Discarded</strong> state, when the user entirely disables telemetry in their client.</li></ul><p>Note that once a client has been disqualified from an experiment, it is not possible for it to be resume showing the experiment treatment.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-wasenrolled-state">The &quot;WasEnrolled&quot; State<a href="#the-wasenrolled-state" class="hash-link" aria-label="Direct link to The &quot;WasEnrolled&quot; State" title="Direct link to The &quot;WasEnrolled&quot; State">​</a></h4><p>In this state, the client remembers that it was previously enrolled in an experiment and may report diagnostic telemetry about this fact, but the experiment has ended and its treatments are no longer activated.</p><p>WasEnrolled experiments are shown in about:studies:</p><p><img loading="lazy" alt="WasEnrolled shown in about:studies" src="data:image/png;base64,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" title="WasEnrolled shown in about:studies" width="1017" height="171" class="img_ev3q"></p><p>It&#x27;s also useful for analysis to have a period of observation (say 30 days?) after an experiment ends in which we still tag telemetry pings with the experiment branch info.</p><p>Transitions:</p><ul><li>To <strong>Discarded</strong> state after 31 days have passed since it entered the <strong>WasEnrolled</strong> state, according to the client&#x27;s local clock.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-errored-state">The &quot;Errored&quot; State<a href="#the-errored-state" class="hash-link" aria-label="Direct link to The &quot;Errored&quot; State" title="Direct link to The &quot;Errored&quot; State">​</a></h4><p>A special state into which the client transitions if it observed any unexpected behaviour, such as invalid experiment config or unexpected experiment-state transitions. In this state the client may log diagnostic telemetry but will not enroll in the experiment nor activate any experiment treatments.</p><p>It is not possible to escape this state, except by discarding the experiment information.</p><p>Transitions:</p><ul><li>To <strong>Discarded</strong> state, when the experiment transitions to <strong>Cancelled</strong> or <strong>Completed</strong>.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-discarded-state">The &quot;Discarded&quot; State<a href="#the-discarded-state" class="hash-link" aria-label="Direct link to The &quot;Discarded&quot; State" title="Direct link to The &quot;Discarded&quot; State">​</a></h4><p>This isn&#x27;t really a state, it&#x27;s just to mark on the diagram the point at which we discard historical data about the experiment from the client&#x27;s local storage.</p><p>Once the client reaches this state, it stops tagging its telemetry pings with information about the experiment.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="telemetry">Telemetry<a href="#telemetry" class="hash-link" aria-label="Direct link to Telemetry" title="Direct link to Telemetry">​</a></h3><p>Nimbus clients will submit telemetry via <a href="https://mozilla.github.io/glean" target="_blank" rel="noopener noreferrer">Glean</a>. The full set of experiment-related telemetry is defined in the <a href="https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11469458/Nimbus+Engineering#NimbusEngineering-ExperimentTelemetry" target="_blank" rel="noopener noreferrer">Nimbus Engineering Confluence page</a>.</p><p>Nimbus will use the <a href="https://mozilla.github.io/glean/book/user/experiments-api.html" target="_blank" rel="noopener noreferrer">Glean Experiments API</a> to tag outgoing metrics pings with information about enrolled experiments:</p><ul><li>After initialization, the Nimbus SDK will list all known experiments in <strong>Enrolled</strong>, <strong>Disqualified </strong>or <strong>WasEnrolled</strong> state and call <code>setExperimentActive(slug, branch)</code> to tag outgoing telemetry pings with the enrolled branch of that experiment.</li><li>When an experiment transitions to <strong>Enrolled</strong> state, the Nimbus SDK will call  <code>setExperimentActive(slug, branch)</code> to tag outgoing telemetry pings with the enrolled branch of the new experiment.</li><li>When an experiment transitions from <strong>WasEnrolled </strong>to <strong>Discarded</strong>, the
Nimbus SDK will call <code>setExperimentInactive(slug)</code> to cease tagging outgoing
telemetry pings with information about the experiment.  Note, that Glean does
not cache or persist the experiment API info, so it&#x27;s important to call
<code>setExperimentActive</code> on every run, preferably close to startup so that
it can annotate any custom pings that may be sent out early during app launch.
The <code>setExperimentInactive</code> only needs to be called if we have called
<code>setExperimentActive</code> for that experiment in the same app run.</li></ul><p>Nimbus will also emit Glean <a href="https://mozilla.github.io/glean/book/user/metrics/event.html" target="_blank" rel="noopener noreferrer">events</a> on key experiment state transitions:</p><ul><li>An &quot;<strong><em>enrollment</em></strong>&quot; event, when an experiment enters the <strong>Enrolled</strong> state.<ul><li>Event field &quot;experiment&quot; records the experiment slug.</li><li>Event field &quot;branch&quot; records the branch into which the client enrolled.</li><li>Event field &quot;enrollmentId&quot; contains a randomly-generated identifier for this enrollment.</li></ul></li><li>A &quot;<strong><em>disqualification</em></strong>&quot; event, when an experiment enters the <strong>Disqualified</strong> state.<ul><li>Event field &quot;experiment&quot; records the experiment slug.</li><li>Event field &quot;branch&quot; records the branch into which the client enrolled.</li><li>Event field &quot;enrollmentId&quot; contains the enrollment id from the corresponding &quot;enrollment&quot; event.</li><li>Event field &quot;reason&quot; containing the reason for disqualification, as one of the following values:<ul><li>&quot;optout&quot;</li><li>&quot;targeting&quot;</li></ul></li></ul></li><li>An &quot;<strong><em>unenrollment</em></strong>&quot; event, when an experiment enters the <strong>WasEnrolled</strong> state.<ul><li>Event field &quot;experiment&quot; records the experiment slug.</li><li>Event field &quot;branch&quot; records the branch into which the client enrolled.</li><li>Event field &quot;enrollmentId&quot; contains the enrollment id from the corresponding &quot;enrollment&quot; event.</li></ul></li></ul><p>Nimbus will also emit Glean <a href="https://mozilla.github.io/glean/book/user/metrics/event.html" target="_blank" rel="noopener noreferrer">events</a> when the client code calls experiment-related APIs:</p><ul><li>An &quot;<strong><em>exposure</em></strong>&quot; event, when client code calls <code>activateExperiment</code> or <code>isFeatureEnabled</code> for the first time, and the experiment is in <strong>Enrolled</strong> state.<ul><li>Event field &quot;experiment&quot; records the experiment slug.</li><li>Event field &quot;branch&quot; records the branch into which the client enrolled.</li><li>Event field &quot;enrollmentId&quot; contains a randomly-generated identifier for this enrollment.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-behaviours">Client Behaviours<a href="#client-behaviours" class="hash-link" aria-label="Direct link to Client Behaviours" title="Direct link to Client Behaviours">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-asked-if-an-experiment-is-active">When asked if an experiment is active<a href="#when-asked-if-an-experiment-is-active" class="hash-link" aria-label="Direct link to When asked if an experiment is active" title="Direct link to When asked if an experiment is active">​</a></h4><ul><li>Get the current client state and last-seen server state for the named experiment.</li><li>If the client state is <strong>Enrolled</strong>, return <em>true</em>.</li><li>Otherwise, return <em>false</em>.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-asked-for-the-current-branch-of-an-experiment">When asked for the current branch of an experiment<a href="#when-asked-for-the-current-branch-of-an-experiment" class="hash-link" aria-label="Direct link to When asked for the current branch of an experiment" title="Direct link to When asked for the current branch of an experiment">​</a></h4><ul><li>Get the current client state and last-seen server state for the named experiment.</li><li>If the client state is <strong>Enrolled</strong>, return the enrolled branch and its config.</li><li>Otherwise, return <em>None</em>.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-asked-for-the-current-config-of-a-feature">When asked for the current config of a feature<a href="#when-asked-for-the-current-config-of-a-feature" class="hash-link" aria-label="Direct link to When asked for the current config of a feature" title="Direct link to When asked for the current config of a feature">​</a></h4><ul><li>Get the current client state and last-seen server state for all experiments.</li><li>Discard any experiments whose client state is not <strong>Enrolled</strong>.</li><li>For each remaining experiment:<ul><li>Get the branch config for the <strong>Enrolled </strong>branch.</li><li>If it does not contain config for the named feature, discard the experiment</li></ul></li><li>If more than one experiment remains, TODO this is an error right? report it somehow.</li><li>If exactly one experiment remains, return the feature config from its <strong>Enrolled</strong> branch.</li><li>Otherwise, return <em>None</em>.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-a-server-update-transitions-an-experiment-to-enrolling">When a server update transitions an experiment to &quot;Enrolling&quot;<a href="#when-a-server-update-transitions-an-experiment-to-enrolling" class="hash-link" aria-label="Direct link to When a server update transitions an experiment to &quot;Enrolling&quot;" title="Direct link to When a server update transitions an experiment to &quot;Enrolling&quot;">​</a></h4><ul><li>If the current client state for the experiment is <strong>Unknown</strong> or <strong>NotEnrolled</strong>:<ul><li>Get the current state for all known experiments that conflict with this one.</li><li>Evaluate targeting/bucketing/etc, if it says to enroll, set client state to <strong>Enrolled</strong>.<ul><li>TODO: trigger a notification in the client app somehow, to redraw UI etc?</li></ul></li><li>Otherwise, set client state to <strong>NotEnrolled</strong>.</li></ul></li><li>If the current client state for the experiment is <strong>Enrolled</strong>:<ul><li>TODO: what exactly? How does an existing enrollment change in response to updated experiment config?</li></ul></li><li>Otherwise, set the current client state for the experiment to <strong>Errored</strong> and log some diagnostic telemetry.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-a-server-update-transitions-an-experiment-to-paused-or-running">When a server update transitions an experiment to &quot;Paused&quot; or &quot;Running&quot;<a href="#when-a-server-update-transitions-an-experiment-to-paused-or-running" class="hash-link" aria-label="Direct link to When a server update transitions an experiment to &quot;Paused&quot; or &quot;Running&quot;" title="Direct link to When a server update transitions an experiment to &quot;Paused&quot; or &quot;Running&quot;">​</a></h4><ul><li>If the current client state for the experiment is <strong>Enrolled</strong>:<ul><li>TODO: trigger a notification in the client app somehow, to redraw UI etc?</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-a-server-update-transitions-an-experiment-to-cancelled-or-completed">When a server update transitions an experiment to &quot;Cancelled&quot; or &quot;Completed&quot;<a href="#when-a-server-update-transitions-an-experiment-to-cancelled-or-completed" class="hash-link" aria-label="Direct link to When a server update transitions an experiment to &quot;Cancelled&quot; or &quot;Completed&quot;" title="Direct link to When a server update transitions an experiment to &quot;Cancelled&quot; or &quot;Completed&quot;">​</a></h4><ul><li>If the current client state for the experiment is <strong>Enrolled</strong>:<ul><li>TODO: trigger a notification in the client app somehow, to redraw UI etc?</li><li>Set client state to <strong>WasEnrolled</strong>.</li></ul></li><li>Otherwise, discard the experiment state.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="during-some-periodic-cleanup-process">During some periodic cleanup process<a href="#during-some-periodic-cleanup-process" class="hash-link" aria-label="Direct link to During some periodic cleanup process" title="Direct link to During some periodic cleanup process">​</a></h4><ul><li>For each experiment in the <strong>WasEnrolled</strong> state:<ul><li>If it has been more than N days since we entered that state, discard the experiment state.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li><a href="https://docs.google.com/document/d/1RD-Ok9jYpa4cyyCAe-SO4xjITKN1ueh37WmN65u5BM4" target="_blank" rel="noopener noreferrer">Nimbus - Experiment Publishing Lifecycle and Permissions</a></li><li><a href="https://docs.google.com/document/d/18Vdn4zZX2D1u9AqzHRY0lUSUbpBdouqWtVp3Bu8vYQA/" target="_blank" rel="noopener noreferrer">Unpacking Unenrollments</a>, an explainer for data analysis needs around unenrolling/disabling experiments</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">Changelog<a href="#changelog" class="hash-link" aria-label="Direct link to Changelog" title="Direct link to Changelog">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2021-04-13-dmose">2021-04-13 (dmose):<a href="#2021-04-13-dmose" class="hash-link" aria-label="Direct link to 2021-04-13 (dmose):" title="Direct link to 2021-04-13 (dmose):">​</a></h4><ul><li>Moved from <a href="https://docs.google.com/document/d/18L3oNriwwLd5TZrM1SaHIfIJXmXqUkwNwQEPwVOTY6Q/edit#" target="_blank" rel="noopener noreferrer">Google Doc</a>, converted to MDX format, and commited to DocsHub.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2020-11-18-rfkelly">2020-11-18 (rfkelly):<a href="#2020-11-18-rfkelly" class="hash-link" aria-label="Direct link to 2020-11-18 (rfkelly):" title="Direct link to 2020-11-18 (rfkelly):">​</a></h4><ul><li>Renamed &quot;activation&quot; to &quot;exposure&quot; in line with terminology discussion from Nimbus Architecture Group meeting.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2020-11-13-rfkelly">2020-11-13 (rfkelly):<a href="#2020-11-13-rfkelly" class="hash-link" aria-label="Direct link to 2020-11-13 (rfkelly):" title="Direct link to 2020-11-13 (rfkelly):">​</a></h4><ul><li>Renamed &quot;disabled&quot;  state to &quot;disqualified&quot;</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2020-11-11-rfkelly">2020-11-11 (rfkelly):<a href="#2020-11-11-rfkelly" class="hash-link" aria-label="Direct link to 2020-11-11 (rfkelly):" title="Direct link to 2020-11-11 (rfkelly):">​</a></h4><ul><li>Added the &quot;disabled&quot; state to client states.</li><li>Added the &quot;telemetry&quot; section.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2020-10-30-rfkelly">2020-10-30 (rfkelly):<a href="#2020-10-30-rfkelly" class="hash-link" aria-label="Direct link to 2020-10-30 (rfkelly):" title="Direct link to 2020-10-30 (rfkelly):">​</a></h4><ul><li>Added the key concept of &quot;disablement&quot; as distinct from unenrollment.</li><li>Simplified server states by:<ul><li>combining &quot;drafting + pending&quot; into &quot;preparing&quot;.<ul><li>also removed hypothetical logic around handling of &quot;startDate&quot; in order to start a pending experiment; it starts when visible in Remote Settings.</li></ul></li><li>combining &quot;completed  + cancelled&quot; into &quot;ended&quot;.</li><li>removed &quot;paused&quot; since it doesn&#x27;t sound like we have such a state that&#x27;s distinct from &quot;running&quot;.</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/deep-dives/specifications/client-sdk-states-and-lifecycle.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/warnings"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Experimenter warnings</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fml-spec"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The Feature Manifest Language</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#key-concepts" class="table-of-contents__link toc-highlight">Key Concepts</a></li><li><a href="#server-side-experiment-states" class="table-of-contents__link toc-highlight">Server-Side Experiment States</a></li><li><a href="#client-side-experiment-states" class="table-of-contents__link toc-highlight">Client-Side Experiment States</a><ul><li><a href="#telemetry" class="table-of-contents__link toc-highlight">Telemetry</a></li></ul></li><li><a href="#client-behaviours" class="table-of-contents__link toc-highlight">Client Behaviours</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3f33d2ba.js"></script>
<script src="/assets/js/main.a8034749.js"></script>
</body>
</html>
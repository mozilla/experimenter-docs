"use strict";(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[5269],{4137:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=a.createContext({}),m=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=m(e.components);return a.createElement(o.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=m(n),k=l,g=d["".concat(o,".").concat(k)]||d[k]||u[k]||r;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=k;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[d]="string"==typeof e?e:l,i[1]=s;for(var m=2;m<r;m++)i[m]=n[m];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},425:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294),l=n(4334);const r={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(r.tabItem,i),hidden:n},t)}},3992:(e,t,n)=>{n.d(t,{Z:()=>C});var a=n(7462),l=n(7294),r=n(4334),i=n(2957),s=n(6550),o=n(5238),m=n(3609),p=n(2560);function d(e){return function(e){return l.Children.map(e,(e=>{if(!e||(0,l.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:l}}=e;return{value:t,label:n,attributes:a,default:l}}))}function u(e){const{values:t,children:n}=e;return(0,l.useMemo)((()=>{const e=t??d(n);return function(e){const t=(0,m.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function k(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:n}=e;const a=(0,s.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,o._X)(r),(0,l.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function N(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,r=u(e),[i,s]=(0,l.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!k({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[o,m]=g({queryString:n,groupId:a}),[d,N]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,p.Nk)(n);return[a,(0,l.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:a}),h=(()=>{const e=o??d;return k({value:e,tabValues:r})?e:null})();(0,l.useLayoutEffect)((()=>{h&&s(h)}),[h]);return{selectedValue:i,selectValue:(0,l.useCallback)((e=>{if(!k({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),m(e),N(e)}),[m,N,r]),tabValues:r}}var h=n(1048);const c={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function f(e){let{className:t,block:n,selectedValue:s,selectValue:o,tabValues:m}=e;const p=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.o5)(),u=e=>{const t=e.currentTarget,n=p.indexOf(t),a=m[n].value;a!==s&&(d(t),o(a))},k=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},m.map((e=>{let{value:t,label:n,attributes:i}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>p.push(e),onKeyDown:k,onClick:u},i,{className:(0,r.Z)("tabs__item",c.tabItem,i?.className,{"tabs__item--active":s===t})}),n??t)})))}function b(e){let{lazy:t,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===a));return e?(0,l.cloneElement)(e,{className:"margin-top--md"}):null}return l.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function y(e){const t=N(e);return l.createElement("div",{className:(0,r.Z)("tabs-container",c.tabList)},l.createElement(f,(0,a.Z)({},e,t)),l.createElement(b,(0,a.Z)({},e,t)))}function C(e){const t=(0,h.Z)();return l.createElement(y,(0,a.Z)({key:String(t)},e))}},6480:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>g,frontMatter:()=>s,metadata:()=>m,toc:()=>d});var a=n(7462),l=(n(7294),n(4137)),r=n(3992),i=n(425);const s={id:"mobile-messaging",title:"Mobile Messaging",slug:"/messaging/mobile-messaging",sidebar_position:7},o="Introduction",m={unversionedId:"workflow/implementing/messaging/mobile-messaging",id:"workflow/implementing/messaging/mobile-messaging",title:"Mobile Messaging",description:"The mobile messaging system is a feature of Firefox on iOS and Android, designed to send in-app messages directly to users without going through a release cycle.",source:"@site/docs/workflow/implementing/messaging/mobile-messaging.mdx",sourceDirName:"workflow/implementing/messaging",slug:"/messaging/mobile-messaging",permalink:"/messaging/mobile-messaging",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/workflow/implementing/messaging/mobile-messaging.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{id:"mobile-messaging",title:"Mobile Messaging",slug:"/messaging/mobile-messaging",sidebar_position:7},sidebar:"sidebar",previous:{title:"Desktop Messaging Journey",permalink:"/messaging/desktop-messaging-journey"},next:{title:"Groups & Campaigns",permalink:"/messaging/groups-and-campaigns"}},p={},d=[{value:"Edit history",id:"edit-history",level:4},{value:"Scene setting",id:"scene-setting",level:2},{value:"Anatomy of a message",id:"anatomy-of-a-message",level:2},{value:"Triggers",id:"triggers",level:3},{value:"Message content",id:"message-content",level:3},{value:"Surfaces",id:"surfaces",level:3},{value:"Actions",id:"actions",level:3},{value:"String substiutions",id:"string-substiutions",level:4},{value:"Other message attributes",id:"other-message-attributes",level:3},{value:"Localization of messages",id:"localization-of-messages",level:2},{value:"Experimenting with messages",id:"experimenting-with-messages",level:2},{value:"Experimenting with localized messages",id:"experimenting-with-localized-messages",level:3},{value:"Control messages",id:"control-messages",level:3},{value:"Displaying the control message",id:"displaying-the-control-message",level:3},{value:"Advanced uses of the <code>{experiment}</code> subsitution",id:"advanced-uses-of-the-experiment-subsitution",level:3},{value:"Events emitted",id:"events-emitted",level:2},{value:"Nimbus Events",id:"nimbus-events",level:3},{value:"Message Events",id:"message-events",level:3},{value:"Extending the system",id:"extending-the-system",level:2},{value:"Adding attributes",id:"adding-attributes",level:3},{value:"Adding custom trigger expressions",id:"adding-custom-trigger-expressions",level:3},{value:"Adding custom actions",id:"adding-custom-actions",level:3},{value:"Lifecycle of a message",id:"lifecycle-of-a-message",level:2},{value:"Appendices",id:"appendices",level:2},{value:"List of trigger expressions",id:"list-of-trigger-expressions",level:3},{value:"List of actions",id:"list-of-actions",level:3},{value:"List of attributes",id:"list-of-attributes",level:3}],u={toc:d},k="wrapper";function g(e){let{components:t,...s}=e;return(0,l.kt)(k,(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"The mobile messaging system is a feature of Firefox on iOS and Android, designed to send in-app messages directly to users without going through a release cycle."),(0,l.kt)("p",null,"It allows staff\u2014\xa0most likely experiment owners, product owners, user research and marketing teams\u2014"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"to send messages to the user audiences, with rules about when to show them."),(0,l.kt)("li",{parentName:"ul"},"to experiment with those messages (the appearance or copy of the message)"),(0,l.kt)("li",{parentName:"ul"},"to allow the user to respond to the message (either dismissing, or opening a specified URL)")),(0,l.kt)("h1",{id:"about-this-document"},"About this document"),(0,l.kt)("p",null,"This document is a guide for staff who wish to send message users through the experimenter interface."),(0,l.kt)("p",null,"It is also a living document:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the messaging system is under active development, and learning from its MVP."),(0,l.kt)("li",{parentName:"ul"},"attributes useful in triggers, and deeplink actions will accrue in each of the embedding apps."),(0,l.kt)("li",{parentName:"ul"},"surfaces are being added to embedding apps.")),(0,l.kt)("p",null,"You can view a demo of sending a survey on mobile ",(0,l.kt)("a",{parentName:"p",href:"https://mozilla.zoom.us/rec/share/CafQjaLn09BtbPvOphePVizKe49IrRF2QHtYcc5zs4XlbmEhHzulcohmvC1WUV49.ZBKmiSNkaw7kbIeJ"},"here"),"\nAccess Passcode: 9Zx9Lg&M"),(0,l.kt)("h4",{id:"edit-history"},"Edit history"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Changed ",(0,l.kt)("inlineCode",{parentName:"li"},"is_default_browser")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"is_default_browser_string"),"."),(0,l.kt)("li",{parentName:"ul"},"Renamed Glean messages to match the implementation."),(0,l.kt)("li",{parentName:"ul"},"Added notification surface and associated trigger expressions."),(0,l.kt)("li",{parentName:"ul"},"v117 - added ",(0,l.kt)("inlineCode",{parentName:"li"},"experiment")," property to message, removed ",(0,l.kt)("inlineCode",{parentName:"li"},"message-under-experiment"),".")),(0,l.kt)("h2",{id:"scene-setting"},"Scene setting"),(0,l.kt)("p",null,"Nimbus Mobile Messaging is built on top of Nimbus, Mozilla's experimentation platform. Nimbus allows you to send bits of configuration to application features from Experimenter, the web-application staff use to launch and manage experiments and rollouts."),(0,l.kt)("p",null,"Using Experimenter in the general case is documented elsewhere, so this document is specifically concerned with configuring the ",(0,l.kt)("inlineCode",{parentName:"p"},"messaging")," feature, via the Branches screen."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"my-first-message in the branch configuration screen",src:n(3026).Z,width:"2106",height:"1912"})),(0,l.kt)("p",null,'The messages that are sent are specified as JSON in the "Value" text area on this screen, so much of this document will consider this the user-interface for sending messages.'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            "surface": "homescreen",\n            "trigger": [\n                "USER_EN_SPEAKER",\n                "USER_RECENTLY_UPDATED"\n            ],\n\n            "title": "Enhance your privacy",\n            "text": "We\'ve improved our tracking protection, tap here to switch it on",\n            "button-label": "Make it so!",\n\n            "action": "OPEN_SETTINGS_TRACKING_PROTECTION"\n        }\n    }\n}\n')),(0,l.kt)("p",null,"We will start with this simple example to introduce the concepts, then add more as we go."),(0,l.kt)("h2",{id:"anatomy-of-a-message"},"Anatomy of a message"),(0,l.kt)("p",null,"Messages have a number of components:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the message key. In this example above, this is ",(0,l.kt)("inlineCode",{parentName:"li"},"my-first-message"),". For most cases, these should be",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"unique so as not to collide with other messages."),(0,l.kt)("li",{parentName:"ul"},"human readable. By convention, these are ",(0,l.kt)("inlineCode",{parentName:"li"},"kebab-case"),"."))),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"trigger"),". This is the conditions that must be ",(0,l.kt)("inlineCode",{parentName:"li"},"true")," for the message to be eligible to be displayed."),(0,l.kt)("li",{parentName:"ul"},"the content of a message. This is the ",(0,l.kt)("inlineCode",{parentName:"li"},"title")," of the message, the ",(0,l.kt)("inlineCode",{parentName:"li"},"text")," and the ",(0,l.kt)("inlineCode",{parentName:"li"},"button-label"),"."),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"surface"),". This is app specific."),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"action")," that is performed if and when the user taps on the button.")),(0,l.kt)("p",null,"If any of these components are missing, then the message is considered ",(0,l.kt)("em",{parentName:"p"},"malformed"),"."),(0,l.kt)("h3",{id:"triggers"},"Triggers"),(0,l.kt)("p",null,"The app provides the messaging system with ",(0,l.kt)("a",{parentName:"p",href:"#list-of-attributes"},"attributes"),". We use JEXL expressions to query these attributes, or trigger messages based on ",(0,l.kt)("a",{parentName:"p",href:"/mobile-behavioral-targeting"},"the user's behavior in the app"),"."),(0,l.kt)("p",null,"To reduce errors and to allow re-use, the JEXL expressions are named. By convention, these names are in ",(0,l.kt)("inlineCode",{parentName:"p"},"SCREAMING_SNAKE_CASE"),"."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"trigger")," attribute of the message is an array of these named trigger expressions."),(0,l.kt)("p",null,"If all of these trigger expressions evaluate to ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),", then the message is said to be ",(0,l.kt)("em",{parentName:"p"},"eligible"),"."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#list-of-trigger-expressions"},"List of available trigger expressions")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#adding-custom-trigger-expressions"},"Adding custom trigger expressions"))),(0,l.kt)("p",null,"For example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            \u2026\n            "trigger": [\n                "USER_EN_SPEAKER",\n                "USER_RECENTLY_UPDATED"\n            ],\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"In the above example, only users who have updated their apps in the last 7 days ",(0,l.kt)("em",{parentName:"p"},"and")," who are English speakers."),(0,l.kt)("h3",{id:"message-content"},"Message content"),(0,l.kt)("p",null,"The message content is provided as strings, and is what the user sees."),(0,l.kt)("p",null,"Only the ",(0,l.kt)("inlineCode",{parentName:"p"},"text")," property is mandatory. If this is missing, then the message is said to be ",(0,l.kt)("em",{parentName:"p"},"malformed"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            \u2026\n\n            "title": "Enhance your privacy",\n            "text": "We\'ve improved our tracking protection, tap here to switch it on",\n            "button-label": "Make it so!",\n\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"If ",(0,l.kt)("inlineCode",{parentName:"p"},"title")," is missing, then the title is not displayed."),(0,l.kt)("p",null,"If ",(0,l.kt)("inlineCode",{parentName:"p"},"button-label")," is missing, then the button is not displayed, but the whole message is tappable."),(0,l.kt)("h3",{id:"surfaces"},"Surfaces"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"surface")," of the message is the message surface on which the message will be displayed."),(0,l.kt)("p",null,"These are app specific: the application provides the surface to draw the message on."),(0,l.kt)(r.Z,{defaultValue:"fenix",values:[{label:"Firefox for Android",value:"fenix"},{label:"Firefox for iOS",value:"fxios"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"fenix",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Surface"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Versions"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"homescreen")),(0,l.kt)("td",{parentName:"tr",align:null},"On the new tab/homescreen"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"notification")),(0,l.kt)("td",{parentName:"tr",align:null},"A system notification. Permission is required for Android SDK > 13"),(0,l.kt)("td",{parentName:"tr",align:null},"v111")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"survey")),(0,l.kt)("td",{parentName:"tr",align:null},"A screen that is shown at startup"),(0,l.kt)("td",{parentName:"tr",align:null}))))),(0,l.kt)(i.Z,{value:"fxios",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Surface"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Versions"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"new-tab-card")),(0,l.kt)("td",{parentName:"tr",align:null},"On the new tab/homescreen"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"notification")),(0,l.kt)("td",{parentName:"tr",align:null},"A system notification."),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"survey")),(0,l.kt)("td",{parentName:"tr",align:null},"A screen that is shown at startup"),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"While there is only one surface, the surface attribute can be omitted."),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in the code itself."))),(0,l.kt)("h3",{id:"actions"},"Actions"),(0,l.kt)("p",null,"Actions are performed when the user taps on the call to action (i.e. the button)."),(0,l.kt)("p",null,"The actions are implemented as URLs, which may be deeplinks in to the app, web links, or deeplinks in to other apps."),(0,l.kt)("p",null,"To reduce errors and to allow re-use, action URLs can be named. By convention, these names are in ",(0,l.kt)("inlineCode",{parentName:"p"},"SCREAMING_SNAKE_CASE"),"."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#list-of-actions"},"List of available actions")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#adding-custom-actions"},"Adding custom actions"))),(0,l.kt)("p",null,"If the specified ",(0,l.kt)("inlineCode",{parentName:"p"},"action")," property contains a ",(0,l.kt)("inlineCode",{parentName:"p"},"://")," it is treated as a bare URL, so one-off URLs may be specified."),(0,l.kt)("h4",{id:"string-substiutions"},"String substiutions"),(0,l.kt)("p",null,"Before the final URL is opened, a variable subsitution is made, so identifiers within a pair of braces may be made part of the URL."),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"#list-of-attributes"},"Any attribute")," that Nimbus Mobile Messaging knows about can be used. For example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n            "my-message": {\n            \u2026\n            "action": "https://mozilla.org/fenix/{locale}/whatsnew/{app_version}"\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Additionally, the special ",(0,l.kt)("inlineCode",{parentName:"p"},"{uuid}")," can be used to generate a new UUID. If detected, this will be recorded as an extra called ",(0,l.kt)("inlineCode",{parentName:"p"},"action-uuid")," on the message's ",(0,l.kt)("inlineCode",{parentName:"p"},"interaction")," event."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        \u2026\n        "action": "https://surveys.thirdparty.org/fenix-viewpoint/?client_id={uuid}"\n        \u2026\n    }\n}\n')),(0,l.kt)("p",null,"This allows the client's anonymous survey results to match up to their Glean data while remaining anonymous to the third party."),(0,l.kt)("h3",{id:"other-message-attributes"},"Other message attributes"),(0,l.kt)("p",null,"There are additional message attributes which don't quite fit anywhere, yet. It is best to leave this unused. We're looking for feedback during the MVP phase."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"style")," \u2013\xa0this is a string key into the ",(0,l.kt)("inlineCode",{parentName:"li"},"styles")," object. It will code for visual style, and/or priority.")),(0,l.kt)("p",null,"Current values are ",(0,l.kt)("inlineCode",{parentName:"p"},"DEFAULT"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"PERSISTENT"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"WARNING"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"URGENT"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"NOTIFICATION"),"."),(0,l.kt)("p",null,"This currently code for:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the message ",(0,l.kt)("inlineCode",{parentName:"li"},"priority"),". Messages will be shown in descending order of priority."),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"max-display-count"),". Messages will be shown to the user for this number of sessions before the message expires.")),(0,l.kt)("h2",{id:"localization-of-messages"},"Localization of messages"),(0,l.kt)("p",null,"Localization of strings and messages is not fully developed in Nimbus: the intention is to integrate with the existing tooling for localizing strings."),(0,l.kt)("p",null,"For message content, you might use identifiers of pre-translated strings (in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/Client/Frontend/Strings.swift#L60"},"Firefox for iOS"),", ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-android/blob/main/fenix/app/src/main/res/values/strings.xml"},"Firefox for Android"),"). This might be useful for very common phrases like OK, or Cancel."),(0,l.kt)("p",null,"However this relies on the exact translations either being coincidentally already in use by the app, or the experimental copy known about before the app was released. For several reasons, we do not recommend this approach."),(0,l.kt)("p",null,"Instead, we can add multiple messages which do the same thing, but in different langauges."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"messages")," property is a JSON object, so can accept multiple messages, each with different locale triggers."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-l10n-message-en": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_EN_SPEAKER"\n            ],\n            "button-label": "Go to settings"\n        },\n        "my-l10n-message-de": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_DE_SPEAKER"\n            ],\n            "button-label": "Einstellungen \xf6ffnen"\n        },\n        "my-l10n-message-es": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_ES_SPEAKER"\n            ],\n            "button-label": "Ir a ajustes"\n        },\n        "my-l10n-message-fr": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_FR_SPEAKER"\n            ],\n            "button-label": "Ouvrir les param\xe8tres"\n        }\n    }\n}\n')),(0,l.kt)("p",null,"For each of the messages,"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the message key should have a common prefix. This becomes important when experimenting with messages."),(0,l.kt)("li",{parentName:"ul"},"the triggers should be the same list of named expressions, but appending the trigger-expression to select for language.")),(0,l.kt)("p",null,"In this manner the locale can be only one value at a time, and only one version of the message is eligible for display at any one time."),(0,l.kt)("h2",{id:"experimenting-with-messages"},"Experimenting with messages"),(0,l.kt)("p",null,"So far, we have talked about using Experimenter to push out messages as single branch experiments."),(0,l.kt)("p",null,"When running experiments, we'll need to configure two or more branches. By convention, each branch will have the same message keys\u2014 in the example below: ",(0,l.kt)("inlineCode",{parentName:"p"},"my-first-message"),"."),(0,l.kt)("p",null,"We should also tell the system that the message is under experiment. This is done by annotating each message with the experiment it came from. For convenience, the system replaces the string ",(0,l.kt)("inlineCode",{parentName:"p"},"{experiment}")," with the experiment slug at enrollment, so annotating the message with the experiment is done like so:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            "experiment": "{experiment}"\n            \u2026\n        }\n    },\n}\n')),(0,l.kt)("h3",{id:"experimenting-with-localized-messages"},"Experimenting with localized messages"),(0,l.kt)("p",null,"We saw when ",(0,l.kt)("a",{parentName:"p",href:"#localization-of-messages"},"localizing messages")," that the branch provided different messages based on adding additional trigger expressions."),(0,l.kt)("p",null,"It is important that:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"each of the different languages represented in one branch is represented in all branches."),(0,l.kt)("li",{parentName:"ul"},"for the messages in each branch, no more than one message will be ",(0,l.kt)("em",{parentName:"li"},"eligible")," for display at any one time. In the example below, the user's locale can only be set to one language at a time, so only one message is triggered at any one time.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-l10n-message-en": {\n            "experiment": "{experiment}",\n            \u2026\n            "surface": "notification",\n            "trigger": [\n                \u2026\n                "USER_EN_SPEAKER"\n            ]\n            \u2026\n        },\n        "my-l10n-message-de": {\n            "experiment": "{experiment}",\n            \u2026\n            "surface": "notification",\n            "trigger": [\n                \u2026\n                "USER_DE_SPEAKER"\n            ],\n            \u2026\n        },\n        "my-l10n-message-es": {\n            "experiment": "{experiment}",\n            \u2026\n            "surface": "notification",\n            "trigger": [\n                \u2026\n                "USER_ES_SPEAKER"\n            ],\n            \u2026\n        },\n        "my-l10n-message-fr": {\n            "experiment": "{experiment}",\n            \u2026\n            "surface": "notification",\n            "trigger": [\n                \u2026\n                "USER_FR_SPEAKER"\n            ],\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Since these triggers are mutually exclusive, the user will only ever be exposed to one message under experiment."),(0,l.kt)("h3",{id:"control-messages"},"Control messages"),(0,l.kt)("p",null,"For most messages in experiments, we'll need to specify a control message."),(0,l.kt)("p",null,"The control is specified in a similar way to others:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            "trigger": [ \u2026 ],\n            "surface": "notification",\n            "experiment": "{experiment}",\n            "is-control": true,\n        }\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Important"),": The control message must be ",(0,l.kt)("em",{parentName:"p"},"eligible")," whenever the treatment message would have been. This means that:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"trigger")," value of the control must match the ",(0,l.kt)("inlineCode",{parentName:"li"},"trigger")," value of the treatment message."),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"surface")," value of the control must match the ",(0,l.kt)("inlineCode",{parentName:"li"},"surface")," value of the treatment message."),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"style")," value of the control must match the ",(0,l.kt)("inlineCode",{parentName:"li"},"style")," value of the treatment message.")),(0,l.kt)("p",null,"For localized messages, we will need to provide a set of contol messages that matches the treatment messages, so that the control message is triggered for all and only the same circumstances as the treatment."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-l10n-message-en": {\n            "experiment": "{experiment}",\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_EN_SPEAKER"\n            ]\n        },\n        "my-l10n-message-de": {\n            "experiment": "{experiment}",\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_DE_SPEAKER"\n            ]\n        },\n        "my-l10n-message-es": {\n            "experiment": "{experiment}",\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_ES_SPEAKER"\n            ],\n            \u2026\n        },\n        "my-l10n-message-fr": {\n            "experiment": "{experiment}",\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_FR_SPEAKER"\n            ]\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Control messages (i.e. messages with ",(0,l.kt)("inlineCode",{parentName:"p"},"is-control")," set to ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),") that do not have an ",(0,l.kt)("inlineCode",{parentName:"p"},"experiment")," set to ",(0,l.kt)("inlineCode",{parentName:"p"},"{experiment}")," will be reported by the client as malformed, since we can't ascertain which experiment they came from."),(0,l.kt)("h3",{id:"displaying-the-control-message"},"Displaying the control message"),(0,l.kt)("p",null,"The control message is the placebo, so doesn't make any sense to display to the user, so when a control message is selected for display, what should a message surface actually display?"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            "trigger": [ \u2026 ],\n            "experiment": "{experiment}",\n            "is-control": true,\n        }\n    },\n    "on-control": "show-next-message"\n}\n')),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"on-control")," property controls what happens in this case:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"show-next-message")," causes the next eligible message to be displayed.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"other messages may come from the app itself or from rollouts that other staff are doing."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"show-none")," causes the message surface not to display anything at all.")),(0,l.kt)("p",null,"By default, ",(0,l.kt)("inlineCode",{parentName:"p"},"on-control")," is set to ",(0,l.kt)("inlineCode",{parentName:"p"},"show-next-message"),"."),(0,l.kt)("h3",{id:"advanced-uses-of-the-experiment-subsitution"},"Advanced uses of the ",(0,l.kt)("inlineCode",{parentName:"h3"},"{experiment}")," subsitution"),(0,l.kt)("p",null,"The literal string ",(0,l.kt)("inlineCode",{parentName:"p"},"{experiment}")," can appear anywhere in the feature configuration, including the message key allows for some deduplication. For example, a regularly repeating message could be set up with message keys derived from the experiment slug."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "{experiment}-en": {\n            "triggers": [\n                "USER_EN_SPEAKER"\n            ],\n            \u2026\n        },\n        "{experiment}-fr": {\n            "triggers": [\n                "USER_FR_SPEAKER"\n            ],\n            \u2026\n        },\n        "{experiment}-es": {\n            "triggers": [\n                "USER_ES_SPEAKER"\n            ],\n            \u2026\n        },\n        "{experiment}-de": {\n            "triggers": [\n                "USER_DE_SPEAKER"\n            ],\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("h2",{id:"events-emitted"},"Events emitted"),(0,l.kt)("h3",{id:"nimbus-events"},"Nimbus Events"),(0,l.kt)("p",null,"Nimbus emits events via Glean for all experiments that the user is enrolled in."),(0,l.kt)("p",null,"Enrollment is a decision taken at start-up about whether the user is eligible for the experiment (i.e. fits the experiment targeting criteria), and is chosen to part of the experiment cohort, i.e. is chosen to be have one of the branches)."),(0,l.kt)("p",null,"Exposure evnts happen when the user is enrolled in the experiment, and the subsequently exposed to the treatment (or the control)."),(0,l.kt)("p",null,"In the case of messaging, exposure events are emitted when a message from one of the branches of an enrolled experiment is shown. For other messages that aren't from an experiment, no exposure events are emitted."),(0,l.kt)("h3",{id:"message-events"},"Message Events"),(0,l.kt)("p",null,"Each of the following events is emitted\u2014 via Glean\u2014 at certain points while the message exists on the user's device."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"message_shown"),": the message is shown to the user."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"message_clicked"),": the user has tapped on the button, or the message itself if a button doesn't exist.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"an ",(0,l.kt)("inlineCode",{parentName:"li"},"action-uuid")," is given as an extra."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"malformed"),": the message sender has somehow made an error specifying a particular message. e.g."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"message_dismissed"),": the message was shown to the user, and tapped the dismiss action. This is message surface dependent."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"message_expired"),": The message has been shown to the user for a number of sessions, and not been interacted with. We therefore expire the message.")),(0,l.kt)("p",null,"Each message has a ",(0,l.kt)("inlineCode",{parentName:"p"},"message-key")," extra."),(0,l.kt)("h2",{id:"extending-the-system"},"Extending the system"),(0,l.kt)("p",null,"Much of the system relies on Nimbus ",(0,l.kt)("a",{parentName:"p",href:"/cookbook/fml/growable-collections"},"merging together JSON objects"),". We have seen this in the ",(0,l.kt)("inlineCode",{parentName:"p"},"messages")," object which can contain messages from the default configuration, rollouts, and experiments."),(0,l.kt)("p",null,"We can also add to the ",(0,l.kt)("inlineCode",{parentName:"p"},"actions"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"triggers")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"styles")," object in the same way. This is covered below, and do not need an engineer."),(0,l.kt)("h3",{id:"adding-attributes"},"Adding attributes"),(0,l.kt)("p",null,"Attributes require an application engineer to add values to the JSON object that is passed to the messaging subsystem."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-android/blob/main/fenix/app/src/main/java/org/mozilla/fenix/messaging/CustomAttributeProvider.kt"},"Firefox for Android")),(0,l.kt)("li",{parentName:"ul"},"[Firefox for iOS]"," (link needed)")),(0,l.kt)("p",null,"Once in this JSON, this becomes available to JEXL expressions and string subsitution."),(0,l.kt)("h3",{id:"adding-custom-trigger-expressions"},"Adding custom trigger expressions"),(0,l.kt)("p",null,"Trigger expressions can be added on a per-message basis, by adding to the ",(0,l.kt)("inlineCode",{parentName:"p"},"triggers")," object."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "triggers": {\n        "DATE_IS_CHRISTMAS": "\'-12-25\' in date_string"\n    },\n\n    "messages": {\n        "happy-christmas-en": {\n            "trigger": [\n                "DATE_IS_CHRISTMAS",\n                "USER_EN_SPEAKER"\n            ]\n            \u2026\n            "title": "Happy Christmas",\n            \u2026\n        },\n        "happy-christmas-fr": {\n            "trigger": [\n                "DATE_IS_CHRISTMAS",\n                "USER_FR_SPEAKER"\n            ]\n            \u2026\n            "title": "Joyeux Noel",\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"DATE_IS_CHRISTMAS")," is now available as a trigger expression in all the messages in the branch."),(0,l.kt)("p",null,"It can be used in all messages only when it is added back to the application's ",(0,l.kt)("a",{parentName:"p",href:"#list-of-trigger-expressions"},"list of trigger expressions"),"."),(0,l.kt)("p",null,"Once a branch has been rolled out, then ",(0,l.kt)("inlineCode",{parentName:"p"},"DATE_IS_CHRISTMAS")," becomes available to all messages."),(0,l.kt)("p",null,"Finally, it can be rolled back in to the product by adding it to the ",(0,l.kt)("inlineCode",{parentName:"p"},"nimbus.fml.yaml")," file, i.e. in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L139"},"Firefox for iOS")," and ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-android/blob/main/android-components/components/service/nimbus/messaging.fml.yaml"},"Firefox for Android"),"."),(0,l.kt)("p",null,"Care should be taken to test this new trigger expression before deploying it."),(0,l.kt)("p",null,"Suitable tools to prototype these expressions:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"This ",(0,l.kt)("a",{parentName:"li",href:"https://czosel.github.io/jexl-playground/#/?context=%7B%0A%20%20%22app_name%22%3A%20%22fenix%22%2C%0A%20%20%22app_id%22%3A%20%22org.mozilla.fenix%22%2C%0A%20%20%22channel%22%3A%20%22release%22%2C%0A%20%20%22app_version%22%3A%20%22101.0.0%22%2C%0A%20%20%22device_manufacturer%22%3A%20%22Samsung%22%2C%0A%20%20%22device_model%22%3A%20%22Note%205%22%2C%0A%20%20%22locale%22%3A%20%22es-US%22%2C%0A%20%20%22os%22%3A%20%22Android%22%2C%0A%20%20%22os_version%22%3A%20%2213.1%22%2C%0A%0A%20%20%22is_default_browser%22%3A%20true%2C%0A%20%20%22date_string%22%3A%20%222022-06-19%22%0A%7D&input='US'%20in%20locale%20%26%26%20'-06-19'%20in%20date_string%0A&transforms=%7B%7D"},"JEXL playground")," is setup to prototype expressions against existing attributes."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/TomFrost/Jexl#all-the-details"},"JEXL documentation"))),(0,l.kt)("h3",{id:"adding-custom-actions"},"Adding custom actions"),(0,l.kt)("p",null,"All actions are implemented as URLs. Ad-hoc URLs can be used for one-off messages, but ",(0,l.kt)("em",{parentName:"p"},"must")," contain the scheme and separator: e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"https://"),"."),(0,l.kt)("p",null,"URLs that start with ",(0,l.kt)("inlineCode",{parentName:"p"},"://")," are taken as deeplinks into the app."),(0,l.kt)("p",null,"You can add URLs as named actions for use by multiple messages."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "actions": {\n        "INSTALL_VPN": "market://details?id=org.mozilla.firefox.vpn"\n    }\n\n    "messages": {\n        "upsell-vpn-en": {\n            \u2026\n            "button-label": "VPN maybe?",\n            "action": "INSTALL_VPN"\n            \u2026\n            "trigger": ["USER_EN_SPEAKER"]\n        },\n        "upsell-vpn-fr": {\n            \u2026\n            "button-label": "VPN peut-\xeatre?",\n            "action": "INSTALL_VPN"\n            \u2026\n            "trigger": ["USER_FR_SPEAKER"]\n        },\n    }\n}\n')),(0,l.kt)("p",null,"Deeplinks are implemented by the application developers in the app."),(0,l.kt)("p",null,"There are two parts to making new actions for messages:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"implementing them so that the app can respond to deeplinks."),(0,l.kt)("li",{parentName:"ul"},"making those links accessible to messages, by adding them to the ",(0,l.kt)("inlineCode",{parentName:"li"},"nimbus.fml.yaml")," file.")),(0,l.kt)("p",null,"For example:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Firefox for Android:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-android/blob/main/fenix/app/src/main/AndroidManifest.xml#L91-L126"},"Deeplinks in the ",(0,l.kt)("inlineCode",{parentName:"a"},"AndroidManifest.xml")),"."),(0,l.kt)("li",{parentName:"ul"},"Corresponding ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-android/blob/main/fenix/app/nimbus.fml.yaml#L23"},(0,l.kt)("inlineCode",{parentName:"a"},"actions")," in the ",(0,l.kt)("inlineCode",{parentName:"a"},"nimbus.fml.yaml")),". Note that the ",(0,l.kt)("inlineCode",{parentName:"li"},"deepLinkScheme")," is omitted in the FML."))),(0,l.kt)("li",{parentName:"ul"},"Firefox for iOS:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/Client/Application/NavigationRouter.swift#L114-L131"},"Deeplinks in the ",(0,l.kt)("inlineCode",{parentName:"a"},"NavigationRouter.swift")),"."),(0,l.kt)("li",{parentName:"ul"},"Corresponding ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L150"},(0,l.kt)("inlineCode",{parentName:"a"},"actions")," in the ",(0,l.kt)("inlineCode",{parentName:"a"},"nimbus.fml.yaml")),". Note that the ",(0,l.kt)("inlineCode",{parentName:"li"},"deepLinkScheme")," is omitted in the FML.")))),(0,l.kt)("p",null,"If the implementation stage has been done, but the FML part hasn't, you can add the action as part of the branch configuration."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "actions": {\n        "FXA_SIGN_IN": "://fxa-signin?signin"\n    },\n\n    "messages": {\n        "upsell-fxa": {\n            \u2026\n            "action": "FXA_SIGN_IN"\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Custom actions can be used in all messages only when they are added back to the application's ",(0,l.kt)("a",{parentName:"p",href:"#list-of-actions"},"list of actions"),"."),(0,l.kt)("h2",{id:"lifecycle-of-a-message"},"Lifecycle of a message"),(0,l.kt)("p",null,"Like all Nimbus enabled features the messaging system configuration (messages, triggers, actions, styles) is likely to undergo a number of phases:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"experimentation"),(0,l.kt)("li",{parentName:"ul"},"rollout the successful messages to the rest of the audience"),(0,l.kt)("li",{parentName:"ul"},"fold-back into the code: copy the successful JSON branches into the nimbus.fml.yaml files where they will become part of the next release.")),(0,l.kt)("h2",{id:"appendices"},"Appendices"),(0,l.kt)("h3",{id:"list-of-trigger-expressions"},"List of trigger expressions"),(0,l.kt)("p",null,"These trigger expressions are based upon the default set of attrbutes available to Nimbus."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Expression name"),(0,l.kt)("th",{parentName:"tr",align:null},"JEXL expression"),(0,l.kt)("th",{parentName:"tr",align:null},"Discussion"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_RECENTLY_INSTALLED")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"days_since_install < 7")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_RECENTLY_UPDATED")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"days_since_update < 7 && days_since_install != days_since_update")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_TIER_ONE_COUNTRY")),(0,l.kt)("td",{parentName:"tr",align:null},"`('US' in locale"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_EN_SPEAKER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'en' in locale")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_DE_SPEAKER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'de' in locale")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_FR_SPEAKER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'fr' in locale")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"DEVICE_ANDROID")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os == 'Android'")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"DEVICE_IOS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os == 'iOS'")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ALWAYS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"true")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"NEVER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"false")),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"These trigger expressions are application specific:"),(0,l.kt)(r.Z,{defaultValue:"fenix",values:[{label:"Firefox for Android",value:"fenix"},{label:"Firefox for iOS",value:"fxios"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"fenix",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Expression name"),(0,l.kt)("th",{parentName:"tr",align:null},"JEXL expression"),(0,l.kt)("th",{parentName:"tr",align:null},"Discussion"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"I_AM_DEFAULT_BROWSER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_default_browser == true")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"I_AM_NOT_DEFAULT_BROWSER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_default_browser == false")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_ESTABLISHED_INSTALL")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"number_of_app_launches >= 4")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"FUNNEL_PAID")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"adjust_campaign != ''")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"FUNNEL_ORGANIC")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"adjust_campaign == ''")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"INACTIVE_1_DAY")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventLastSeen('Hours') >= 24")),(0,l.kt)("td",{parentName:"tr",align:null},"User has not launched the app for 24h or more")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"INACTIVE_2_DAYS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventLastSeen('Days', 0) >= 2")),(0,l.kt)("td",{parentName:"tr",align:null},"User has not launched the app for 1 d or more")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"INACTIVE_3_DAYS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventLastSeen('Days', 0) >= 3")),(0,l.kt)("td",{parentName:"tr",align:null},"User has not launched the app for 2 d or more")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"INACTIVE_4_DAYS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventLastSeen('Days', 0) >= 4")),(0,l.kt)("td",{parentName:"tr",align:null},"User has not launched the app for 3 d or more")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"INACTIVE_5_DAYS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventLastSeen('Days', 0) >= 5")),(0,l.kt)("td",{parentName:"tr",align:null},"User has not launched the app for 4 d or more")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"FXA_SIGNED_IN")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'sync_auth.sign_in'\\|eventLastSeen('Years', 0) <= 4")),(0,l.kt)("td",{parentName:"tr",align:null},"User has signed in to FxA in the last 4 years")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"FXA_NOT_SIGNED_IN")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'sync_auth.sign_in'\\|eventLastSeen('Years', 0) > 4")),(0,l.kt)("td",{parentName:"tr",align:null},"User has not signed in to FxA in the last 4 years")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_INFREQUENT")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventCountNonZero('Days', 28) >= 1 && 'app_launched'\\|eventCountNonZero('Days', 28) < 7")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11469471/Core+Active"},"User definition"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_CASUAL")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventCountNonZero('Days', 28) >= 7 && 'app_launched'\\|eventCountNonZero('Days', 28) < 14")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11469471/Core+Active"},"User definition"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_REGULAR")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventCountNonZero('Days', 28) >= 14 && 'app_launched'\\|eventCountNonZero('Days', 28) < 21")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11469471/Core+Active"},"User definition"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_CORE_ACTIVE")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventCountNonZero('Days', 28) >= 21")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11469471/Core+Active"},"User definition"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"LAUNCHED_ONCE_THIS_WEEK")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'app_launched'\\|eventSum('Days', 7) == 1")),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-android/blob/main/android-components/components/service/nimbus/messaging.fml.yaml"},"the code")," itself.")),(0,l.kt)(i.Z,{value:"fxios",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Expression name"),(0,l.kt)("th",{parentName:"tr",align:null},"JEXL expression"),(0,l.kt)("th",{parentName:"tr",align:null},"Discussion")))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L139"},"the code")," itself."))),(0,l.kt)("h3",{id:"list-of-actions"},"List of actions"),(0,l.kt)("p",null,"These all correspond to the existing deeplinks in each app, so are entirely app specific."),(0,l.kt)(r.Z,{defaultValue:"fenix",values:[{label:"Firefox for Android",value:"fenix"},{label:"Firefox for iOS",value:"fxios"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"fenix",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Action"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Corresponding Deeplink"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ENABLE_PRIVATE_BROWSING")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://enable_private_browsing"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"INSTALL_SEARCH_WIDGET")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://install_search_widget"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MAKE_DEFAULT_BROWSER")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://make_default_browser"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_ACCESSIBILITY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_accessibility"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_ADDON_MANAGER")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_addon_manager"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_DELETE_BROWSING_DATA")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_delete_browsing_data"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_LOGINS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_logins"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_NOTIFICATIONS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_notifications"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_PRIVACY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_privacy"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_SEARCH_ENGINE")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_search_engine"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_TRACKING_PROTECTION")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_tracking_protection"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_WALLPAPERS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_wallpapers"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"TURN_ON_SYNC")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://turn_on_sync"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_BOOKMARKS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://urls_bookmarks"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_COLLECTIONS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://home_collections"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_HISTORY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://urls_history"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_HOMESCREEN")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://home")))))),(0,l.kt)(i.Z,{value:"fxios",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Action"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Corresponding Deeplink"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ENABLE_PRIVATE_BROWSING")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/new-private-tab"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MAKE_DEFAULT_BROWSER")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=default-browser/system-settings"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_EMAIL")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/mailto"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_FXA")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/fxa"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_HOMESCREEN")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/homepage"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_NEW_TAB")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/newtab"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_PRIVACY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/clear-private-data"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_SEARCH_ENGINE")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/search"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_THEME")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/theme"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_WALLPAPERS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/wallpaper"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/general"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_BOOKMARKS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/bookmarks"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_DOWNLOADS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/downloads"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_HISTORY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/history"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_READING_LIST")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/reading-list"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_TOP_SITES")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/top-sites"))))))),(0,l.kt)("h3",{id:"list-of-attributes"},"List of attributes"),(0,l.kt)("p",null,"By convention these are in ",(0,l.kt)("inlineCode",{parentName:"p"},"snake_case"),"."),(0,l.kt)("p",null,"These attributes are defined by the Nimbus SDK."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Attribute"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_name")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_id")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"channel")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_version")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_build")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"architecture")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"device_manufacturer")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"device_model")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"locale")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os_version")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"android_sdk_version")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"debug_tag")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"installation_date")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"home_directory")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"These attributes are application specific."),(0,l.kt)("p",null,"Unfortunately, the JEXL evaluator used does not have support for ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla/jexl-rs/issues/15"},"negation"),",\nso boolean attributes use equality or inequality."),(0,l.kt)(r.Z,{defaultValue:"fenix",values:[{label:"Firefox for Android",value:"fenix"},{label:"Firefox for iOS",value:"fxios"}],mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"fenix",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Attribute"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Versions"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"date_string")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"In YYYY-MM-DD format"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_default_browser")),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null},"JEXL.rs does not implement ",(0,l.kt)("a",{parentName:"td",href:"https://github.com/mozilla/jexl-rs/issues/15"},"boolean negation ",(0,l.kt)("inlineCode",{parentName:"a"},"!"))),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"number_of_app_launches")),(0,l.kt)("td",{parentName:"tr",align:null},"int"),(0,l.kt)("td",{parentName:"tr",align:null},"Indicates how many times the app has been launched."),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"adjust_campaign")),(0,l.kt)("td",{parentName:"tr",align:null},"string?"),(0,l.kt)("td",{parentName:"tr",align:null},"The campaign id parameter as derived by Adjust"),(0,l.kt)("td",{parentName:"tr",align:null},"v111")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"adjust_network")),(0,l.kt)("td",{parentName:"tr",align:null},"string?"),(0,l.kt)("td",{parentName:"tr",align:null},"The network parameter as derived by Adjust"),(0,l.kt)("td",{parentName:"tr",align:null},"v111")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"adjust_ad_group")),(0,l.kt)("td",{parentName:"tr",align:null},"string?"),(0,l.kt)("td",{parentName:"tr",align:null},"The Ad Group parameter as derived by Adjust"),(0,l.kt)("td",{parentName:"tr",align:null},"v111")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"adjust_creative")),(0,l.kt)("td",{parentName:"tr",align:null},"string?"),(0,l.kt)("td",{parentName:"tr",align:null},"The Creative parameter as derived by Adjust"),(0,l.kt)("td",{parentName:"tr",align:null},"v111")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"are_notifications_enabled")),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null},"JEXL.rs does not implement ",(0,l.kt)("a",{parentName:"td",href:"https://github.com/mozilla/jexl-rs/issues/15"},"boolean negation ",(0,l.kt)("inlineCode",{parentName:"a"},"!"))),(0,l.kt)("td",{parentName:"tr",align:null},"v111")))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-android/blob/main/fenix/app/src/main/java/org/mozilla/fenix/messaging/CustomAttributeProvider.kt"},"the code")," itself.")),(0,l.kt)(i.Z,{value:"fxios",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Attribute"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Versions"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"date_string")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"In YYYY-MM-DD format"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_default_browser")),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null},"JEXL.rs does not implement ",(0,l.kt)("a",{parentName:"td",href:"https://github.com/mozilla/jexl-rs/issues/15"},"boolean negation ",(0,l.kt)("inlineCode",{parentName:"a"},"!"))),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in the code itself."))))}g.isMDXComponent=!0},3026:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/branch-config-531fa6456fe2deb488b1142daf1a0b2c.png"}}]);
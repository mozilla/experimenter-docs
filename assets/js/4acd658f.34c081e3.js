"use strict";(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[6549],{4137:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var i=a.createContext({}),u=function(e){var t=a.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},c="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},y=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(r),y=n,m=c["".concat(i,".").concat(y)]||c[y]||f[y]||o;return r?a.createElement(m,s(s({ref:t},p),{},{components:r})):a.createElement(m,s({ref:t},p))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,s=new Array(o);s[0]=y;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[c]="string"==typeof e?e:n,s[1]=l;for(var u=2;u<o;u++)s[u]=r[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,r)}y.displayName="MDXCreateElement"},1309:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>f,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=r(7462),n=(r(7294),r(4137));const o={id:"early-startup-faq",title:"Early Startup FAQ",slug:"/early-startup-faq"},s=void 0,l={unversionedId:"faq/early-startup/early-startup-faq",id:"faq/early-startup/early-startup-faq",title:"Early Startup FAQ",description:"Common questions about using the Early Startup feature in Nimbus experiments.",source:"@site/docs/faq/early-startup/early-startup-faq.mdx",sourceDirName:"faq/early-startup",slug:"/early-startup-faq",permalink:"/early-startup-faq",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/faq/early-startup/early-startup-faq.mdx",tags:[],version:"current",frontMatter:{id:"early-startup-faq",title:"Early Startup FAQ",slug:"/early-startup-faq"},sidebar:"sidebar",previous:{title:"Mobile First Run",permalink:"/faq/first-run"},next:{title:"Feature restart",permalink:"/faq/feature-restart"}},i={},u=[{value:"What Does Early Startup Do?",id:"what-does-early-startup-do",level:2},{value:"How Early is Early?",id:"how-early-is-early",level:2},{value:"Early on Desktop",id:"early-on-desktop",level:3},{value:"Early on Mobile",id:"early-on-mobile",level:3}],p={toc:u},c="wrapper";function f(e){let{components:t,...r}=e;return(0,n.kt)(c,(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Common questions about using the Early Startup feature in Nimbus experiments."),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"There is info on how to use Early Startup ",(0,n.kt)("a",{parentName:"p",href:"/platform-guides/desktop/feature-api/#registering-a-new-feature"},"here in the documentation"))),(0,n.kt)("h2",{id:"what-does-early-startup-do"},"What Does Early Startup Do?"),(0,n.kt)("p",null,'Include "isEarlyStartup" in the FeatureManifest.yaml if you need synchronous access / very early access at startup or if you are registering this to use for platform experiments.'),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"What does this do?")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"It caches the feature values to disk using temporary prefs so that they're available as soon as user prefs are initialized and loaded, so they're available earlier in browser initialization and also helps make them available to gecko more easily."),(0,n.kt)("li",{parentName:"ul"},"IsEarlyStartup means we persist the experiment data in prefs so you can a) use them from c++ or b) use the JS experiment API before we've loaded experiments from disk.")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"So why don't I always use Early Startup to be sure my feature is controllable by an experiment early enough?")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"You have to reconcile storing state in multiple places, it's only needed for a specific set of features in specific circumstances, so for the rest of them it's much safer to not touch the pref store at all and only worry about a single source of state."),(0,n.kt)("li",{parentName:"ul"},"It also makes tests more annoying because if you don't clean them up properly it's easy to break adjacent tests")),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"how-early-is-early"},"How Early is Early?"),(0,n.kt)("h3",{id:"early-on-desktop"},"Early on Desktop"),(0,n.kt)("p",null,"The 'isEarlyStartup' flag for features will write variables to prefs to ensure data is available once prefs are loaded.\nNimbus uses its own internal prefs. If you're talking to Nimbus via JS you can just interact with it normally and it\nwill read from prefs if it hasn't yet loaded its data store. Then you can use the ",(0,n.kt)("a",{parentName:"p",href:"https://searchfox.org/mozilla-central/source/toolkit/components/nimbus/lib/NimbusFeatures.h"},"C++ API"),"."),(0,n.kt)("p",null,"You don't have to do anything special though, as long as isEarlyStartup is set it should Just Work.\nAssuming everything is main thread, you shouldn't have any issues."),(0,n.kt)("p",null,"First startup initializes Nimbus, which will then try to grab experiments and rollouts for all features (",(0,n.kt)("a",{parentName:"p",href:"https://searchfox.org/mozilla-central/rev/fb9a504ca73529fa550efe488db2a012a4bf5169/toolkit/modules/FirstStartup.sys.mjs#50"},"code"),").\nThis happens before we paint the first window. First startup blocks painting."),(0,n.kt)("h3",{id:"early-on-mobile"},"Early on Mobile"),(0,n.kt)("p",null,"TBD"))}f.isMDXComponent=!0}}]);
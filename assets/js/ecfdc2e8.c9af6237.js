"use strict";(globalThis.webpackChunkexperimenter_docs=globalThis.webpackChunkexperimenter_docs||[]).push([[9697],{5680(e,n,t){t.d(n,{xA:()=>c,yg:()=>m});var r=t(6540);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=r.createContext({}),u=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=u(e.components);return r.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),g=u(t),m=l,f=g["".concat(s,".").concat(m)]||g[m]||p[m]||a;return t?r.createElement(f,o(o({ref:n},c),{},{components:t})):r.createElement(f,o({ref:n},c))}));function m(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var a=t.length,o=new Array(a);o[0]=g;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var u=2;u<a;u++)o[u]=t[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},5305(e,n,t){t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>u});var r=t(8168),l=(t(6540),t(5680));const a={id:"coenrolling-features",title:"Co-enrolling Features",slug:"/technical-reference/fml/coenrolling-features",sidebar_position:6},o=void 0,i={unversionedId:"technical-reference/fml/coenrolling-features",id:"technical-reference/fml/coenrolling-features",title:"Co-enrolling Features",description:"A feature which allows co-enrollment allows a client to be enrolled in any number of experiments/rollouts for that feature.",source:"@site/docs/technical-reference/fml/coenrolling-features.mdx",sourceDirName:"technical-reference/fml",slug:"/technical-reference/fml/coenrolling-features",permalink:"/technical-reference/fml/coenrolling-features",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/technical-reference/fml/coenrolling-features.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{id:"coenrolling-features",title:"Co-enrolling Features",slug:"/technical-reference/fml/coenrolling-features",sidebar_position:6},sidebar:"sidebar",previous:{title:"CLI",permalink:"/technical-reference/fml/fml-cli"},next:{title:"Feature Metadata",permalink:"/technical-reference/fml/feature-metadata"}},s={},u=[{value:"How to define a co-enrolling feature",id:"how-to-define-a-co-enrolling-feature",level:2},{value:"Recording exposure",id:"recording-exposure",level:2},{value:"Desktop",id:"desktop",level:3},{value:"Other things to note about co-enrollment",id:"other-things-to-note-about-co-enrollment",level:2}],c={toc:u};function p(e){let{components:n,...t}=e;return(0,l.yg)("wrapper",(0,r.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,l.yg)("p",null,"A feature which allows co-enrollment allows a client to be enrolled in any number of experiments/rollouts for that feature. "),(0,l.yg)("p",null,(0,l.yg)("strong",{parentName:"p"},"Features supporting co-enrollment")),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("a",{parentName:"li",href:"/messaging/desktop/mobile-messaging"},"Messaging")," (Fenix, Firefox iOS, Focus for Android, Focus for iOS)"),(0,l.yg)("li",{parentName:"ul"},"Firefox Desktop \u2014 any feature with ",(0,l.yg)("inlineCode",{parentName:"li"},"allowCoenrollment: true")," in ",(0,l.yg)("a",{parentName:"li",href:"https://searchfox.org/mozilla-central/source/toolkit/components/nimbus/FeatureManifest.yaml"},"FeatureManifest.yaml")," (e.g., ",(0,l.yg)("inlineCode",{parentName:"li"},"prefFlips"),")")),(0,l.yg)("h2",{id:"how-to-define-a-co-enrolling-feature"},"How to define a co-enrolling feature"),(0,l.yg)("p",null,"A feature can be marked as allowing co-enrollment with a boolean flag in its feature definition in a Feature Manifest."),(0,l.yg)("p",null,(0,l.yg)("strong",{parentName:"p"},"Mobile (FML):")," In your ",(0,l.yg)("inlineCode",{parentName:"p"},".fml.yaml")," file:"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-yaml"},"features:\n  messaging:\n    description: |\n      The in-app messaging system.\n    allow-coenrollment: true\n    variables:\n      messages:\n        description: A growable collection of messages\n        type: Map<String, MessageData>\n        default: {}\n")),(0,l.yg)("p",null,(0,l.yg)("strong",{parentName:"p"},"Desktop:")," In ",(0,l.yg)("inlineCode",{parentName:"p"},"FeatureManifest.yaml"),":"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-yaml"},"prefFlips:\n  description: Pref flips for incident response\n  allowCoenrollment: true\n  variables:\n    prefs:\n      type: json\n")),(0,l.yg)("p",null,"Once your feature is defined as a co-enrolling feature, a client can be enrolled in any number of experiments/rollouts for that feature."),(0,l.yg)("h2",{id:"recording-exposure"},"Recording exposure"),(0,l.yg)("p",null,"In order to ",(0,l.yg)("a",{parentName:"p",href:"/technical-reference/fml/growable-collections#exposure-events"},"record exposure")," for a co-enrolled feature, the string ",(0,l.yg)("inlineCode",{parentName:"p"},"{experiment}")," needs to exist in the feature config somewhere. In the case of messaging, this would be in the message object:"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-yaml"},"objects:\n  MessageData:\n    ...\n    fields:\n      experiment:\n        type: Option<String>\n        description: The slug of the experiment that this message came from.\n        default: null\n")),(0,l.yg)("p",null,"This string is then replaced with the experiment slug at enrollment time."),(0,l.yg)("p",null,"The feature code that the developer is writing needs to get the experiment slug from the feature config and record the exposure with ",(0,l.yg)("inlineCode",{parentName:"p"},"recordExperimentExposure(experimentSlug)"),". In Kotlin, this would look like:"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-kotlin"},"val slug = message.data.experiment ?: return message\n\nmessagingFeature.recordExperimentExposure(slug)\n")),(0,l.yg)("h3",{id:"desktop"},"Desktop"),(0,l.yg)("p",null,"On Desktop, co-enrolling features use the ",(0,l.yg)("inlineCode",{parentName:"p"},"{slug}")," option on ",(0,l.yg)("inlineCode",{parentName:"p"},"recordExposureEvent()"),":"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-js"},'NimbusFeatures.myFeature.recordExposureEvent({ slug: "experiment-slug" });\n')),(0,l.yg)("p",null,"Standard per-feature methods like ",(0,l.yg)("inlineCode",{parentName:"p"},"getVariable()")," and ",(0,l.yg)("inlineCode",{parentName:"p"},"getAllVariables()")," throw for co-enrolling features. Instead, use these APIs:"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},(0,l.yg)("inlineCode",{parentName:"strong"},"getAllEnrollments()"))," \u2014 returns ",(0,l.yg)("inlineCode",{parentName:"li"},"{ meta: { slug, branch, isRollout }, value: object }[]")," with both metadata and resolved feature values for each enrollment."),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},(0,l.yg)("inlineCode",{parentName:"strong"},"getAllEnrollmentMetadata()"))," \u2014 returns ",(0,l.yg)("inlineCode",{parentName:"li"},"{ slug, branch, isRollout }[]")," (metadata only).")),(0,l.yg)("p",null,"See the ",(0,l.yg)("a",{parentName:"p",href:"/platform-guides/desktop/feature-api"},"Desktop Feature API reference")," for full details."),(0,l.yg)("h2",{id:"other-things-to-note-about-co-enrollment"},"Other things to note about co-enrollment"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Experiment feature values still take precedence over rollout feature values"),(0,l.yg)("li",{parentName:"ul"},"Enrollment/unenrollment is calculated independently for each experiment/rollout regardless of whether they target the same feature or not"),(0,l.yg)("li",{parentName:"ul"},"Enrollment/unenrollment telemetry is still sent for each experiment/rollout at the time each enrolls or unenrolls")))}p.isMDXComponent=!0}}]);
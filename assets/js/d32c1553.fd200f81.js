"use strict";(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[9135],{4137:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>f});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),u=i,f=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return a?n.createElement(f,o(o({ref:t},c),{},{components:a})):n.createElement(f,o({ref:t},c))}));function f(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},1414:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var n=a(7462),i=(a(7294),a(4137));const r={id:"auto-sizing-cli",title:"Sizing CLI",slug:"/data-analysis/auto-sizing-cli"},o=void 0,s={unversionedId:"data-analysis/auto-sizing-cli",id:"data-analysis/auto-sizing-cli",title:"Sizing CLI",description:"The sample size calculation functionality contained in the [Mozanalysis] library is accessible via a command-line interface (CLI), [auto-sizing]. This CLI is intended to enable rapid analyses for simple experiments or experiments with targeting similar to past experiments.",source:"@site/docs/data-analysis/auto-sizing-cli.md",sourceDirName:"data-analysis",slug:"/data-analysis/auto-sizing-cli",permalink:"/data-analysis/auto-sizing-cli",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/data-analysis/auto-sizing-cli.md",tags:[],version:"current",frontMatter:{id:"auto-sizing-cli",title:"Sizing CLI",slug:"/data-analysis/auto-sizing-cli"},sidebar:"sidebar",previous:{title:"Experiment Sizing",permalink:"/data-analysis/experiment-sizing"},next:{title:"Bucketing",permalink:"/data-analysis/data-topics/bucketing"}},l={},p=[{value:"Sizing job configuration",id:"sizing-job-configuration",level:2},{value:"TOML file layout",id:"toml-file-layout",level:3},{value:"CLI commands",id:"cli-commands",level:2},{value:"CLI output",id:"cli-output",level:2}],c={toc:p},d="wrapper";function m(e){let{components:t,...a}=e;return(0,i.kt)(d,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The sample size calculation functionality contained in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/mozilla/mozanalysis"},"Mozanalysis")," library is accessible via a command-line interface (CLI), ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("a",{parentName:"strong",href:"https://github.com/mozilla/auto-sizing"},"auto-sizing")),". This CLI is intended to enable rapid analyses for simple experiments or experiments with targeting similar to past experiments."),(0,i.kt)("h2",{id:"sizing-job-configuration"},"Sizing job configuration"),(0,i.kt)("p",null,"The sizing CLI relies on a local TOML file to configure the job. This TOML file contains the metrics, segments, and parameters used to carry out the analysis. Sample sizes based on these parameters are calculated using the ",(0,i.kt)("a",{parentName:"p",href:"https://mozilla.github.io/mozanalysis/api/frequentist_stats/sample_size.html#mozanalysis.frequentist_stats.sample_size.z_or_t_ind_sample_size_calc"},(0,i.kt)("inlineCode",{parentName:"a"},"mozanalysis.frequentist_stats.sample_size.z_or_t_ind_sample_size_calc"))," method. Note that segments in Mozanalysis refer to the filters used to identify clients that will satisfy targeting for an experiment (whereas segments in Jetstream denote groups of clients to examine during post-hoc analysis)."),(0,i.kt)("h3",{id:"toml-file-layout"},"TOML file layout"),(0,i.kt)("p",null,"The TOML configuration file must contain a ",(0,i.kt)("inlineCode",{parentName:"p"},"metrics"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"data_sources"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"segments"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"segments.data_sources")," section, each containing the definitions for those of interest for the experiments. The definition of each of these follows the same patterns as ",(0,i.kt)("a",{parentName:"p",href:"/data-analysis/jetstream/overview"},"Jetstream"),", and details on how to define your own inside of the TOML file can be found ",(0,i.kt)("a",{parentName:"p",href:"/data-analysis/jetstream/configuration#defining-metrics"},"here"),"."),(0,i.kt)("p",null,"The TOML file can also contain references to metrics, segments, data sources, and segment data sources that are already contained in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/mozilla/metric-hub"},"metric-hub"),". To reference these pre-defined objects, an ",(0,i.kt)("inlineCode",{parentName:"p"},"import_from_metric_hub")," list can be included in the TOML file. For instance, to import the ",(0,i.kt)("inlineCode",{parentName:"p"},"active_hours")," metric for Firefox Desktop, the following is included in the TOML config file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[metrics.import_from_metric_hub]\nfirefox_desktop = ["active_hours"]\n')),(0,i.kt)("p",null,"A ",(0,i.kt)("inlineCode",{parentName:"p"},"parameters")," section in the TOML file is used to define the data collection period for the analysis and the parameters used to calculate sample sizes. This section consists of two subsections: ",(0,i.kt)("inlineCode",{parentName:"p"},"parameters.sizing")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"parameters.dates"),":"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"parameters.sizing"),": Contains two tags, ",(0,i.kt)("inlineCode",{parentName:"li"},"power")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"effect_size"),". These tags should contain lists of values for each parameter, and a sample size will be calculated for all metrics provided in the TOML file for each combination of power and effect size in those lists."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"parameters.dates"),": Contains the ",(0,i.kt)("inlineCode",{parentName:"li"},"start_date"),' (in "%Y-%m-%d" format, e.g. "2023-01-01"), ',(0,i.kt)("inlineCode",{parentName:"li"},"num_dates_enrollment"),", and ",(0,i.kt)("inlineCode",{parentName:"li"},"analysis_length")," values. For details on how those values are used to query historical data, see the ",(0,i.kt)("a",{parentName:"li",href:"https://experimenter.info/experiment-sizing"},"Mozanalysis documentation"),".")),(0,i.kt)("h2",{id:"cli-commands"},"CLI commands"),(0,i.kt)("p",null,"The sizing CLI is invoked using the command ",(0,i.kt)("inlineCode",{parentName:"p"},"auto_sizing run"),". The following options are available at invocation:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"--project_id"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"--project-id")),(0,i.kt)("td",{parentName:"tr",align:null},"BigQuery project to write metrics table to")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"--dataset_id"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"--dataset-id")),(0,i.kt)("td",{parentName:"tr",align:null},"BigQuery dataset to write metrics table to")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"--bucket")),(0,i.kt)("td",{parentName:"tr",align:null},"GCP bucket to write output JSON to. If not provided, JSON will be saved to the same directory as the config TOML")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"--target_slug")),(0,i.kt)("td",{parentName:"tr",align:null},"Name for the experiment. Used when naming metrics table and output file")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"--local_config")),(0,i.kt)("td",{parentName:"tr",align:null},"Path to the configuration TOML file")))),(0,i.kt)("h2",{id:"cli-output"},"CLI output"),(0,i.kt)("p",null,"Results for experiment sizing are saved in JSON format. If a GCP bucket is provided in the ",(0,i.kt)("inlineCode",{parentName:"p"},"--bucket")," option at invocation, this JSON file is saved in a ",(0,i.kt)("inlineCode",{parentName:"p"},"sample_sizes")," folder in that bucket. If no bucket is provided, the JSON results are saved to the same folder as the TOML configuration file. "),(0,i.kt)("p",null,"The results JSON will include an entry for each combination of power and effect size provided in the config file. Each of these has an entry for each metric, where the required population percent and sample size per branch to achieve that power with that effect size is recorded. A final tag is included with a parameters dictionary, storing the power and effect size values. The following example shows the results for a sizing job with the metrics ",(0,i.kt)("inlineCode",{parentName:"p"},"uri_count")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"active_hours"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{"Power0.8EffectSize0.01": {\n        "uri_count": {"sample_size_per_branch": 475269, "population_percent_per_branch": 6.25}, \n        "active_hours": {"sample_size_per_branch": 327233, "population_percent_per_branch": 4.3}, \n        "parameters": {"power": 0.8, "effect_size": 0.01}}, \n"Power0.8EffectSize0.02": {\n        "uri_count": {"sample_size_per_branch": 118817, "population_percent_per_branch": 1.56}, \n        "active_hours": {"sample_size_per_branch": 81808, "population_percent_per_branch": 1.08}, \n        "parameters": {"power": 0.8, "effect_size": 0.02}}}\n')))}m.isMDXComponent=!0}}]);
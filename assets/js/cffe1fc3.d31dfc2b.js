(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[1392],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return g}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),m=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=m(e.components);return a.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=m(n),g=i,k=u["".concat(o,".").concat(g)]||u[g]||d[g]||l;return n?a.createElement(k,r(r({ref:t},p),{},{components:n})):a.createElement(k,r({ref:t},p))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,r=new Array(l);r[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var m=2;m<l;m++)r[m]=n[m];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8215:function(e,t,n){"use strict";var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,i=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:i},t)}},5064:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var a=n(7294),i=n(9443);var l=function(){var e=(0,a.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},r=n(6010),s="tabItem_1uMI",o="tabItemActive_2DSg";var m=function(e){var t,n=e.lazy,i=e.block,m=e.defaultValue,p=e.values,d=e.groupId,u=e.className,g=a.Children.toArray(e.children),k=null!=p?p:g.map((function(e){return{value:e.props.value,label:e.props.label}})),N=null!=m?m:null==(t=g.find((function(e){return e.props.default})))?void 0:t.props.value,h=l(),c=h.tabGroupChoices,f=h.setTabGroupChoices,b=(0,a.useState)(N),y=b[0],E=b[1],C=[];if(null!=d){var x=c[d];null!=x&&x!==y&&k.some((function(e){return e.value===x}))&&E(x)}var _=function(e){var t=e.currentTarget,n=C.indexOf(t),a=k[n].value;E(a),null!=d&&(f(d,a),setTimeout((function(){var e,n,a,i,l,r,s,m;(e=t.getBoundingClientRect(),n=e.top,a=e.left,i=e.bottom,l=e.right,r=window,s=r.innerHeight,m=r.innerWidth,n>=0&&l<=m&&i<=s&&a>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(o),setTimeout((function(){return t.classList.remove(o)}),2e3))}),150))},v=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=C.indexOf(e.target)+1;n=C[a]||C[0];break;case"ArrowLeft":var i=C.indexOf(e.target)-1;n=C[i]||C[C.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":i},u)},k.map((function(e){var t=e.value,n=e.label;return a.createElement("li",{role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,className:(0,r.Z)("tabs__item",s,{"tabs__item--active":y===t}),key:t,ref:function(e){return C.push(e)},onKeyDown:v,onFocus:_,onClick:_},null!=n?n:t)}))),n?(0,a.cloneElement)(g.filter((function(e){return e.props.value===y}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},g.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==y})}))))}},9443:function(e,t,n){"use strict";var a=(0,n(7294).createContext)(void 0);t.Z=a},4707:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return m},metadata:function(){return p},toc:function(){return d},default:function(){return g}});var a=n(2122),i=n(9756),l=(n(7294),n(3905)),r=n(5064),s=n(8215),o={id:"mobile-messaging",title:"Using the Experimenter to send messages to Mobile clients",slug:"/mobile-messaging"},m=void 0,p={unversionedId:"messaging/mobile-messaging",id:"messaging/mobile-messaging",isDocsHomePage:!1,title:"Using the Experimenter to send messages to Mobile clients",description:"[fxios-actions-fml]//github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L150",source:"@site/docs/messaging/gleanplumb.mdx",sourceDirName:"messaging",slug:"/mobile-messaging",permalink:"/mobile-messaging",editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/messaging/gleanplumb.mdx",tags:[],version:"current",frontMatter:{id:"mobile-messaging",title:"Using the Experimenter to send messages to Mobile clients",slug:"/mobile-messaging"},sidebar:"sidebar",previous:{title:"Messaging System Frequency cap",permalink:"/frequency-cap"}},d=[{value:"Scene setting",id:"scene-setting",children:[]},{value:"Anatomy of a message",id:"anatomy-of-a-message",children:[{value:"Triggers",id:"triggers",children:[]},{value:"Message content",id:"message-content",children:[]},{value:"Actions",id:"actions",children:[]},{value:"Other message attributes",id:"other-message-attributes",children:[]}]},{value:"Localization of messages",id:"localization-of-messages",children:[]},{value:"Experimenting with messages",id:"experimenting-with-messages",children:[{value:"Experimenting with localized messages",id:"experimenting-with-localized-messages",children:[]},{value:"Control messages",id:"control-messages",children:[]},{value:"Displaying the control message",id:"displaying-the-control-message",children:[]}]},{value:"Events emitted",id:"events-emitted",children:[{value:"Nimbus Events",id:"nimbus-events",children:[]},{value:"Message Events",id:"message-events",children:[]}]},{value:"Extending the system",id:"extending-the-system",children:[{value:"Adding attributes",id:"adding-attributes",children:[]},{value:"Adding custom trigger expressions",id:"adding-custom-trigger-expressions",children:[]},{value:"Adding custom actions",id:"adding-custom-actions",children:[]}]},{value:"Lifecycle of a message",id:"lifecycle-of-a-message",children:[]},{value:"Appendices",id:"appendices",children:[{value:"List of trigger expressions",id:"list-of-trigger-expressions",children:[]},{value:"List of actions",id:"list-of-actions",children:[]},{value:"List of attributes",id:"list-of-attributes",children:[]}]}],u={toc:d};function g(e){var t=e.components,o=(0,i.Z)(e,["components"]);return(0,l.kt)("wrapper",(0,a.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"The GleanPlumb messaging system is a feature of Firefox on iOS and Android, designed to send in-app messages directly to users without going through a release cycle."),(0,l.kt)("p",null,"It allows staff\u2014\xa0most likely experiment owners, product owners, user research and marketing teams\u2014"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"to send messages to the user audiences, with rules about when to show them."),(0,l.kt)("li",{parentName:"ul"},"to experiment with those messages (the appearance or copy of the message)"),(0,l.kt)("li",{parentName:"ul"},"to allow the user to respond to the message (either dismissing, or opening a specified URL)")),(0,l.kt)("h1",{id:"about-this-document"},"About this document"),(0,l.kt)("p",null,"This document is a guide for staff who wish to send message users through the experimenter interface."),(0,l.kt)("p",null,"It is also a living document:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the messaging system is under active development, and learning from its MVP."),(0,l.kt)("li",{parentName:"ul"},"attributes useful in triggers, and deeplink actions will accrue in each of the embedding apps.")),(0,l.kt)("h2",{id:"scene-setting"},"Scene setting"),(0,l.kt)("p",null,"GleanPlumb is built on top of Nimbus, Mozilla's experimentation platform. Nimbus allows you to send bits of configuration to application features from Experimenter, the web-application staff use to launch and manage experiments and rollouts."),(0,l.kt)("p",null,"Using Experimenter in the general case is documented elsewhere, so this document is specifically concerned with configuring the ",(0,l.kt)("inlineCode",{parentName:"p"},"messaging")," feature, via the Branches screen."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"my-first-message in the branch configuration screen",src:n(9537).Z})),(0,l.kt)("p",null,'The messages that are sent are specified as JSON in the "Value" text area on this screen, so much of this document will consider this the user-interface for sending messages.'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            "trigger": [\n                "USER_EN_SPEAKER",\n                "USER_RECENTLY_UPDATED"\n            ],\n\n            "title": "Enhance your privacy",\n            "text": "We\'ve improved our tracking protection, tap here to switch it on",\n            "button-label": "Make it so!",\n\n            "action": "OPEN_SETTINGS_TRACKING_PROTECTION"\n        }\n    }\n}\n')),(0,l.kt)("p",null,"We will start with this simple example to introduce the concepts, then add more as we go."),(0,l.kt)("h2",{id:"anatomy-of-a-message"},"Anatomy of a message"),(0,l.kt)("p",null,"Messages have a number of components:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the message key. In this example above, this is ",(0,l.kt)("inlineCode",{parentName:"li"},"my-first-message"),". For most cases, these should be",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"unique so as not to collide with other messages."),(0,l.kt)("li",{parentName:"ul"},"human readable. By convention, these are ",(0,l.kt)("inlineCode",{parentName:"li"},"kebab-case"),"."))),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"trigger"),". This is the conditions that must be ",(0,l.kt)("inlineCode",{parentName:"li"},"true")," for the message to be eligible to be displayed."),(0,l.kt)("li",{parentName:"ul"},"the content of a message. This is the ",(0,l.kt)("inlineCode",{parentName:"li"},"title")," of the message, the ",(0,l.kt)("inlineCode",{parentName:"li"},"text")," and the ",(0,l.kt)("inlineCode",{parentName:"li"},"button-label"),"."),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"action")," that is performed if and when the user taps on the button.")),(0,l.kt)("p",null,"If any of these components are missing, then the message is considered ",(0,l.kt)("em",{parentName:"p"},"malformed"),"."),(0,l.kt)("h3",{id:"triggers"},"Triggers"),(0,l.kt)("p",null,"The app provides the messaging system with ",(0,l.kt)("a",{parentName:"p",href:"#list-of-attributes"},"attributes"),". We use JEXL expressions to query these attributes."),(0,l.kt)("p",null,"To reduce errors and to allow re-use, the JEXL expressions are named. By convention, these names are in ",(0,l.kt)("inlineCode",{parentName:"p"},"SCREAMING_SNAKE_CASE"),"."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"trigger")," attribute of the message is an array of these named trigger expressions."),(0,l.kt)("p",null,"If all of these trigger expressions evaluate to ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),", then the message is said to be ",(0,l.kt)("em",{parentName:"p"},"eligible"),"."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#list-of-trigger-expressions"},"List of available trigger expressions")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#adding-custom-trigger-expressions"},"Adding custom trigger expressions"))),(0,l.kt)("p",null,"For example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            \u2026\n            "trigger": [\n                "USER_EN_SPEAKER",\n                "USER_RECENTLY_UPDATED"\n            ],\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"In the above example, only users who have updated their apps in the last 7 days ",(0,l.kt)("em",{parentName:"p"},"and")," who are English speakers."),(0,l.kt)("h3",{id:"message-content"},"Message content"),(0,l.kt)("p",null,"The message content is provided as strings, and is what the user sees."),(0,l.kt)("p",null,"Only the ",(0,l.kt)("inlineCode",{parentName:"p"},"text")," property is mandatory. If this is missing, then the message is said to be ",(0,l.kt)("em",{parentName:"p"},"malformed"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            \u2026\n\n            "title": "Enhance your privacy",\n            "text": "We\'ve improved our tracking protection, tap here to switch it on",\n            "button-label": "Make it so!",\n\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"If ",(0,l.kt)("inlineCode",{parentName:"p"},"title")," is missing, then the title is not displayed."),(0,l.kt)("p",null,"If ",(0,l.kt)("inlineCode",{parentName:"p"},"button-label")," is missing, then the button is not displayed, but the whole message is tappable."),(0,l.kt)("h3",{id:"actions"},"Actions"),(0,l.kt)("p",null,"Actions are performed when the user taps on the call to action (i.e. the button)."),(0,l.kt)("p",null,"The actions are implemented as URLs, which may be deeplinks in to the app, web links, or deeplinks in to other apps."),(0,l.kt)("p",null,"To reduce errors and to allow re-use, action URLs can be named. By convention, these names are in ",(0,l.kt)("inlineCode",{parentName:"p"},"SCREAMING_SNAKE_CASE"),"."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#list-of-actions"},"List of available actions")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#adding-custom-actions"},"Adding custom actions"))),(0,l.kt)("p",null,"If the specified ",(0,l.kt)("inlineCode",{parentName:"p"},"action")," property contains a ",(0,l.kt)("inlineCode",{parentName:"p"},"://")," it is treated as a bare URL, so one-off URLs may be specified."),(0,l.kt)("h4",{id:"string-substiutions"},"String substiutions"),(0,l.kt)("p",null,"Before the final URL is opened, a variable subsitution is made, so identifiers within a pair of braces may be made part of the URL."),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"#list-of-attributes"},"Any attribute")," that GleanPlumb knows about can be used. For example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n            "my-message": {\n            \u2026\n            "action": "https://mozilla.org/fenix/{locale}/whatsnew/{app_version}"\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Additionally, the special ",(0,l.kt)("inlineCode",{parentName:"p"},"{uuid}")," can be used to generate a new UUID. If detected, this will be recorded as an extra called ",(0,l.kt)("inlineCode",{parentName:"p"},"action-uuid")," on the message's ",(0,l.kt)("inlineCode",{parentName:"p"},"interaction")," event."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        \u2026\n        "action": "https://surveys.thirdparty.org/fenix-viewpoint/?client_id={uuid}"\n        \u2026\n    }\n}\n')),(0,l.kt)("p",null,"This allows the client's anonymous survey results to match up to their Glean data while remaining anonymous to the third party."),(0,l.kt)("h3",{id:"other-message-attributes"},"Other message attributes"),(0,l.kt)("p",null,"There are additional message attributes which don't quite fit anywhere, yet. It is best to leave this unused. We're looking for feedback during the MVP phase."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"style")," \u2013\xa0this is a string key into the ",(0,l.kt)("inlineCode",{parentName:"li"},"styles")," object. It will code for visual style, and/or priority.")),(0,l.kt)("p",null,"Current values are ",(0,l.kt)("inlineCode",{parentName:"p"},"DEFAULT"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"PERSISTENT"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"WARNING"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"URGENT"),"."),(0,l.kt)("p",null,"This currently code for:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the message ",(0,l.kt)("inlineCode",{parentName:"li"},"priority"),". Messages will be shown in descending order of priority."),(0,l.kt)("li",{parentName:"ul"},"the ",(0,l.kt)("inlineCode",{parentName:"li"},"max-display-count"),". Messages will be shown to the user for this number of sessions before the message expires.")),(0,l.kt)("h2",{id:"localization-of-messages"},"Localization of messages"),(0,l.kt)("p",null,"Localization of strings and messages is not fully developed in Nimbus: the intention is to integrate with the existing tooling for localizing strings."),(0,l.kt)("p",null,"For message content, you might use identifiers of pre-translated strings (in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/Client/Frontend/Strings.swift#L60"},"Firefox for iOS"),", ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/fenix/blob/main/app/src/main/res/values/strings.xml"},"Firefox for Android"),"). This might be useful for very common phrases like OK, or Cancel."),(0,l.kt)("p",null,"However this relies on the exact translations either being coincidentally already in use by the app, or the experimental copy known about before the app was released. For several reasons, we do not recommend this approach."),(0,l.kt)("p",null,"Instead, we can add multiple messages which do the same thing, but in different langauges."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"messages")," property is a JSON object, so can accept multiple messages, each with different locale triggers."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-l10n-message-en": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_EN_SPEAKER"\n            ],\n            "button-label": "Go to settings"\n        },\n        "my-l10n-message-de": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_DE_SPEAKER"\n            ],\n            "button-label": "Einstellungen \xf6ffnen"\n        },\n        "my-l10n-message-es": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_ES_SPEAKER"\n            ],\n            "button-label": "Ir a ajustes"\n        },\n        "my-l10n-message-fr": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_FR_SPEAKER"\n            ],\n            "button-label": "Ouvrir les param\xe8tres"\n        }\n    }\n}\n')),(0,l.kt)("p",null,"For each of the messages,"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"the message key should have a common prefix. This becomes important when experimenting with messages."),(0,l.kt)("li",{parentName:"ul"},"the triggers should be the same list of named expressions, but appending the trigger-expression to select for language.")),(0,l.kt)("p",null,"In this manner the locale can be only one value at a time, and only one version of the mesaage is eligible for display at any one time."),(0,l.kt)("h2",{id:"experimenting-with-messages"},"Experimenting with messages"),(0,l.kt)("p",null,"So far, we have talked about using Experimenter to push out messages as single branch experiments."),(0,l.kt)("p",null,"When running experiments, we'll need to configure two or more branches. By convention, each branch will have the same message keys (in the example below ",(0,l.kt)("inlineCode",{parentName:"p"},"my-first-message"),"."),(0,l.kt)("p",null,"We should also tell the system that a particular message is under experiment."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": { \u2026\xa0}\n    },\n    "message-under-experiment": "my-first-message"\n}\n')),(0,l.kt)("p",null,"It is important that the message key matches the ",(0,l.kt)("inlineCode",{parentName:"p"},"message-under-experiment")," value: when message with this key is displayed to the user, Nimbus exposure events are recorded."),(0,l.kt)("p",null,"N.B. It's a feature of Nimbus to ensure that any one user will only be exposed to one experimental message at a time."),(0,l.kt)("h3",{id:"experimenting-with-localized-messages"},"Experimenting with localized messages"),(0,l.kt)("p",null,"We saw when ",(0,l.kt)("a",{parentName:"p",href:"#localization-of-messages"},"localizing messages")," that the branch provided different messages based on adding additional trigger expressions."),(0,l.kt)("p",null,"It is important that:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"each of the different languages represented in one branch is represented in all branches."),(0,l.kt)("li",{parentName:"ul"},"for the messages in each branch, no more than one message will be ",(0,l.kt)("em",{parentName:"li"},"eligible")," for display at any one time. In the example below, the user's locale can only be set to one language at a time, so only one message is triggered at any one time.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-l10n-message-en": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_EN_SPEAKER"\n            ]\n            \u2026\n        },\n        "my-l10n-message-de": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_DE_SPEAKER"\n            ],\n            \u2026\n        },\n        "my-l10n-message-es": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_ES_SPEAKER"\n            ],\n            \u2026\n        },\n        "my-l10n-message-fr": {\n            \u2026\n            "trigger": [\n                \u2026\n                "USER_FR_SPEAKER"\n            ],\n            \u2026\n        }\n    }\n\n    "message-under-experiment": "my-l10n-message-"\n}\n')),(0,l.kt)("p",null,"If the ",(0,l.kt)("inlineCode",{parentName:"p"},"message-under-experiment")," property ends in a ",(0,l.kt)("inlineCode",{parentName:"p"},"-"),", then any message with a message key which is prefixed by that value is considered under experiment."),(0,l.kt)("p",null,"Since these triggers are mutually exclusive, the user will only ever be exposed to one message under experiment."),(0,l.kt)("h3",{id:"control-messages"},"Control messages"),(0,l.kt)("p",null,"For most messages, we'll need to specify a control message."),(0,l.kt)("p",null,"The control is specified in a similar way to others:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            "trigger": [ \u2026 ],\n            "is-control": true,\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Because ",(0,l.kt)("inlineCode",{parentName:"p"},"is-control")," set to ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),", we don't need to specify a value for ",(0,l.kt)("inlineCode",{parentName:"p"},"message-under-experiment"),". The system can deduce that the message is under experiment."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Important"),": The control message must be ",(0,l.kt)("em",{parentName:"p"},"eligible")," whenever the treatment message would have been. This means that the ",(0,l.kt)("inlineCode",{parentName:"p"},"trigger")," value of the control must match the ",(0,l.kt)("inlineCode",{parentName:"p"},"trigger")," value of the treatment message."),(0,l.kt)("p",null,"For localized messages, we will need to provide a set of contol messages that matches the treatment messages, so that the control message is triggered for all and only the same circumstances as the treatment."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-l10n-message-en": {\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_EN_SPEAKER"\n            ]\n        },\n        "my-l10n-message-de": {\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_DE_SPEAKER"\n            ]\n        },\n        "my-l10n-message-es": {\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_ES_SPEAKER"\n            ],\n            \u2026\n        },\n        "my-l10n-message-fr": {\n            "is-control": true,\n            "trigger": [\n                \u2026\n                "USER_FR_SPEAKER"\n            ]\n        }\n    }\n}\n')),(0,l.kt)("h3",{id:"displaying-the-control-message"},"Displaying the control message"),(0,l.kt)("p",null,"The control message is the placebo, so doesn't make any sense to display to the user, so when a control message is selected for display, what should a message surface actually display?"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "messages": {\n        "my-first-message": {\n            "trigger": [ \u2026 ],\n            "is-control": true,\n        }\n    },\n    "on-control": "show-next-message"\n}\n')),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"on-control")," property controls what happens in this case:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"show-next-message")," causes the next eligible message to be displayed.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"other messages may come from the app itself or from rollouts that other staff are doing."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"show-none")," causes the message surface not to display anything at all.")),(0,l.kt)("p",null,"By default, ",(0,l.kt)("inlineCode",{parentName:"p"},"on-control")," is set to ",(0,l.kt)("inlineCode",{parentName:"p"},"show-next-message"),"."),(0,l.kt)("h2",{id:"events-emitted"},"Events emitted"),(0,l.kt)("h3",{id:"nimbus-events"},"Nimbus Events"),(0,l.kt)("p",null,"Nimbus emits events via Glean for all experiments that the user is enrolled in."),(0,l.kt)("p",null,"Enrollment is a decision taken at start-up about whether the user is eligible for the experiment (i.e. fits the experiment targeting criteria), and is chosen to part of the experiment cohort, i.e. is chosen to be have one of the branches)."),(0,l.kt)("p",null,"Exposure evnts happen when the user is enrolled in the experiment, and the subsequently exposed to the treatment (or the control)."),(0,l.kt)("p",null,"In the case of messaging, exposure events are emitted when the user is enrolled, and the message in one of the message is shown. For other messages that aren't from an experiment, no exposure events are emitted."),(0,l.kt)("h3",{id:"message-events"},"Message Events"),(0,l.kt)("p",null,"Each of the following events is emitted\u2014 via Glean\u2014 at certain points while the message exists on the user's device."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"impression"),": the message is shown to the user."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"interaction"),": the user has tapped on the button, or the message itself if a button doesn't exist.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"an ",(0,l.kt)("inlineCode",{parentName:"li"},"action-uuid")," is given as an extra."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"malformed"),": the message sender has somehow made an error specifying a particular message. e.g."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"dismissed"),": the message was shown to the user, and tapped the dismiss action. This is message surface dependent."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"expired"),": The message has been shown to the user for a number of sessions, and not been interacted with. We therefore expire the message.")),(0,l.kt)("p",null,"Each message has a ",(0,l.kt)("inlineCode",{parentName:"p"},"message-key")," extra."),(0,l.kt)("h2",{id:"extending-the-system"},"Extending the system"),(0,l.kt)("p",null,"Much of the system relies on Nimbus ",(0,l.kt)("a",{parentName:"p",href:"/cookbook/fml/growable-collections"},"merging together JSON objects"),". We have seen this in the ",(0,l.kt)("inlineCode",{parentName:"p"},"messages")," object which can contain messages from the default configuration, rollouts, and experiments."),(0,l.kt)("p",null,"We can also add to the ",(0,l.kt)("inlineCode",{parentName:"p"},"actions"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"triggers")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"styles")," object in the same way. This is covered below, and do not need an engineer."),(0,l.kt)("h3",{id:"adding-attributes"},"Adding attributes"),(0,l.kt)("p",null,"Attributes require an application engineer to add values to the JSON object that is passed to the messaging subsystem."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#missing-link"},"Firefox for Android")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#missing-link"},"Firefox for iOS"))),(0,l.kt)("p",null,"Once in this JSON, this becomes available to JEXL expressions and string subsitution."),(0,l.kt)("h3",{id:"adding-custom-trigger-expressions"},"Adding custom trigger expressions"),(0,l.kt)("p",null,"Trigger expressions can be added on a per-message basis, by adding to the ",(0,l.kt)("inlineCode",{parentName:"p"},"triggers")," object."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "triggers": {\n        "DATE_IS_CHRISTMAS": "\'-12-25\' in data-string"\n    },\n\n    "messages": {\n        "happy-christmas-en": {\n            "trigger": [\n                "DATE_IS_CHRISTMAS",\n                "USER_EN_SPEAKER"\n            ]\n            \u2026\n            "title": "Happy Christmas",\n            \u2026\n        },\n        "happy-christmas-fr": {\n            "trigger": [\n                "DATE_IS_CHRISTMAS",\n                "USER_FR_SPEAKER"\n            ]\n            \u2026\n            "title": "Joyeux Noel",\n            \u2026\n        }\n    }\n}\n')),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"DATE_IS_CHRISTMAS")," is now available as a trigger expression in all the messages in the branch."),(0,l.kt)("p",null,"It can be used in all messages only when it is added back to the application's ",(0,l.kt)("a",{parentName:"p",href:"#list-of-trigger-expressions"},"list of trigger expressions"),"."),(0,l.kt)("p",null,"Once a branch has been rolled out, then ",(0,l.kt)("inlineCode",{parentName:"p"},"DATE_IS_CHRISTMAS")," becomes available to all messages."),(0,l.kt)("p",null,"Finally, it can be rolled back in to the product by adding it to the ",(0,l.kt)("inlineCode",{parentName:"p"},"nimbus.fml.yaml")," file, i.e. in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L139"},"Firefox for iOS")," and ",(0,l.kt)("a",{parentName:"p",href:"#missing-link"},"Firefox for Android"),"."),(0,l.kt)("p",null,"Care should be taken to test this new trigger expression before deploying it."),(0,l.kt)("p",null,"Suitable tools to prototype these expressions:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"This ",(0,l.kt)("a",{parentName:"li",href:"https://czosel.github.io/jexl-playground/#/?context=%7B%0A%20%20%22app_name%22%3A%20%22fenix%22%2C%0A%20%20%22app_id%22%3A%20%22org.mozilla.fenix%22%2C%0A%20%20%22channel%22%3A%20%22release%22%2C%0A%20%20%22app_version%22%3A%20%22101.0.0%22%2C%0A%20%20%22device_manufacturer%22%3A%20%22Samsung%22%2C%0A%20%20%22device_model%22%3A%20%22Note%205%22%2C%0A%20%20%22locale%22%3A%20%22es-US%22%2C%0A%20%20%22os%22%3A%20%22Android%22%2C%0A%20%20%22os_version%22%3A%20%2213.1%22%2C%0A%0A%20%20%22is_default_browser%22%3A%20true%2C%0A%20%20%22date_string%22%3A%20%222022-06-19%22%0A%7D&input='US'%20in%20locale%20%26%26%20'-06-19'%20in%20date_string%0A&transforms=%7B%7D"},"JEXL playground")," is setup to prototype expressions against existing attributes."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/TomFrost/Jexl#all-the-details"},"JEXL documentation"))),(0,l.kt)("h3",{id:"adding-custom-actions"},"Adding custom actions"),(0,l.kt)("p",null,"All actions are implemented as URLs. Ad-hoc URLs can be used for one-off messages, but ",(0,l.kt)("em",{parentName:"p"},"must")," contain the scheme and separator: e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"https://"),"."),(0,l.kt)("p",null,"URLs that start with ",(0,l.kt)("inlineCode",{parentName:"p"},"://")," are taken as deeplinks into the app."),(0,l.kt)("p",null,"You can add URLs as named actions for use by multiple messages."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "actions": {\n        "INSTALL_VPN": "market://details?id=org.mozilla.firefox.vpn"\n    }\n\n    "messages": {\n        "upsell-vpn-en": {\n            \u2026\n            "button-label": "VPN maybe?",\n            "action": "INSTALL_VPN"\n            \u2026\n            "trigger": ["USER_EN_SPEAKER"]\n        },\n        "upsell-vpn-fr": {\n            \u2026\n            "button-label": "VPN peut-\xeatre?",\n            "action": "INSTALL_VPN"\n            \u2026\n            "trigger": ["USER_FR_SPEAKER"]\n        },\n    }\n}\n')),(0,l.kt)("p",null,"Deeplinks are implemented by the application developers in the app."),(0,l.kt)("p",null,"There are two parts to making new actions for messages:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"- implementing them so that the app can respond to deeplinks.\n- making those links accessible to messages, by adding them to the `nimbus.fml.yaml` file.\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Firefox for Android:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/fenix/blob/main/app/src/main/AndroidManifest.xml#L91-L126"},"Deeplinks in the ",(0,l.kt)("inlineCode",{parentName:"a"},"AndroidManifest.xml")),"."),(0,l.kt)("li",{parentName:"ul"},"Corresponding ",(0,l.kt)("a",{parentName:"li",href:"#missing-link"},(0,l.kt)("inlineCode",{parentName:"a"},"actions")," in the ",(0,l.kt)("inlineCode",{parentName:"a"},"nimbus.fml.yaml")),". Note that the ",(0,l.kt)("inlineCode",{parentName:"li"},"deepLinkScheme")," is omitted in the FML."))),(0,l.kt)("li",{parentName:"ul"},"Firefox for iOS:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/Client/Application/NavigationRouter.swift#L114-L131"},"Deeplinks in the ",(0,l.kt)("inlineCode",{parentName:"a"},"NavigationRouter.swift")),"."),(0,l.kt)("li",{parentName:"ul"},"Corresponding ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L150"},(0,l.kt)("inlineCode",{parentName:"a"},"actions")," in the ",(0,l.kt)("inlineCode",{parentName:"a"},"nimbus.fml.yaml")),". Note that the ",(0,l.kt)("inlineCode",{parentName:"li"},"deepLinkScheme")," is omitted in the FML.")))),(0,l.kt)("p",null,"If the implementation stage has been done, but the FML part hasn't, you can add the action as part of the branch configuration."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "actions": {\n        "FXA_SIGN_IN": "://fxa-signin?signin"\n    },\n\n    "messages": {\n        "upsell-fxa": {\n            \u2026\n            "action": "FXA_SIGN_IN"\n        }\n    }\n}\n')),(0,l.kt)("p",null,"Custom actions can be used in all messages only when they are added back to the application's ",(0,l.kt)("a",{parentName:"p",href:"#list-of-actions"},"list of actions"),"."),(0,l.kt)("h2",{id:"lifecycle-of-a-message"},"Lifecycle of a message"),(0,l.kt)("p",null,"Like all Nimbus enabled features the messaging system configuration (messages, triggers, actions, styles) is likely to undergo a number of phases:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"experimentation"),(0,l.kt)("li",{parentName:"ul"},"rollout the successful messages to the rest of the audience"),(0,l.kt)("li",{parentName:"ul"},"fold-back into the code: copy the successful JSON branches into the nimbus.fml.yaml files where they will become part of the next release.")),(0,l.kt)("h2",{id:"appendices"},"Appendices"),(0,l.kt)("h3",{id:"list-of-trigger-expressions"},"List of trigger expressions"),(0,l.kt)("p",null,"These trigger expressions are based upon the default set of attrbutes available to Nimbus."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Expression name"),(0,l.kt)("th",{parentName:"tr",align:null},"JEXL expression"),(0,l.kt)("th",{parentName:"tr",align:null},"Discussion"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_RECENTLY_INSTALLED")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"days_since_install < 7")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_RECENTLY_UPDATED")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"days_since_update < 7 && days_since_install != days_since_update")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_TIER_ONE_COUNTRY")),(0,l.kt)("td",{parentName:"tr",align:null},"`('US' in locale"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_EN_SPEAKER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'en' in locale")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_DE_SPEAKER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'de' in locale")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"USER_FR_SPEAKER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"'fr' in locale")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"DEVICE_ANDROID")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os == 'Android'")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"DEVICE_IOS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os == 'iOS'")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ALWAYS")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"true")),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"NEVER")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"false")),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"These trigger expressions are application specific:"),(0,l.kt)(r.Z,{defaultValue:"fenix",values:[{label:"Firefox for Android",value:"fenix"},{label:"Firefox for iOS",value:"fxios"}],mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"fenix",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Expression name"),(0,l.kt)("th",{parentName:"tr",align:null},"JEXL expression"),(0,l.kt)("th",{parentName:"tr",align:null},"Discussion")))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in ",(0,l.kt)("a",{parentName:"p",href:"#missing-link"},"the code")," itself.")),(0,l.kt)(s.Z,{value:"fxios",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Expression name"),(0,l.kt)("th",{parentName:"tr",align:null},"JEXL expression"),(0,l.kt)("th",{parentName:"tr",align:null},"Discussion")))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L139"},"the code")," itself."))),(0,l.kt)("h3",{id:"list-of-actions"},"List of actions"),(0,l.kt)("p",null,"These all correspond to the existing deeplinks in each app, so are entirely app specific."),(0,l.kt)(r.Z,{defaultValue:"fenix",values:[{label:"Firefox for Android",value:"fenix"},{label:"Firefox for iOS",value:"fxios"}],mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"fenix",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Action"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Corresponding Deeplink"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ENABLE_PRIVATE_BROWSING")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://enable_private_browsing"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"INSTALL_SEARCH_WIDGET")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://install_search_widget"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MAKE_DEFAULT_BROWSER")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://make_default_browser"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_ACCESSIBILITY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_accessibility"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_ADDON_MANAGER")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_addon_manager"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_DELETE_BROWSING_DATA")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_delete_browsing_data"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_LOGINS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_logins"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_NOTIFICATIONS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_notifications"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_PRIVACY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_privacy"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_SEARCH_ENGINE")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_search_engine"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_TRACKING_PROTECTION")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_tracking_protection"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_WALLPAPERS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings_wallpapers"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://settings"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"TURN_ON_SYNC")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://turn_on_sync"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_BOOKMARKS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://urls_bookmarks"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_COLLECTIONS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://home_collections"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_HISTORY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://urls_history"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_HOMESCREEN")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://home")))))),(0,l.kt)(s.Z,{value:"fxios",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Action"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Corresponding Deeplink"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ENABLE_PRIVATE_BROWSING")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/new-private-tab"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MAKE_DEFAULT_BROWSER")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=default-browser/system-settings"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_EMAIL")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/mailto"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_FXA")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/fxa"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_HOMESCREEN")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/homepage"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_NEW_TAB")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/newtab"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_PRIVACY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/clear-private-data"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_SEARCH_ENGINE")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/search"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_THEME")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/theme"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS_WALLPAPERS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/wallpaper"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"OPEN_SETTINGS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=settings/general"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_BOOKMARKS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/bookmarks"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_DOWNLOADS")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/downloads"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_HISTORY")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/history"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_READING_LIST")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/reading-list"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"VIEW_TOP_SITES")),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"firefox://deep-link?url=homepanel/top-sites"))))))),(0,l.kt)("h3",{id:"list-of-attributes"},"List of attributes"),(0,l.kt)("p",null,"By convention these are in ",(0,l.kt)("inlineCode",{parentName:"p"},"snake_case"),"."),(0,l.kt)("p",null,"These attributes are defined by the Nimbus SDK."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Attribute"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_name")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_id")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"channel")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_version")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"app_build")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"architecture")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"device_manufacturer")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"device_model")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"locale")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"os_version")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"android_sdk_version")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"debug_tag")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"installation_date")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"home_directory")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"These attributes are application specific."),(0,l.kt)(r.Z,{defaultValue:"fenix",values:[{label:"Firefox for Android",value:"fenix"},{label:"Firefox for iOS",value:"fxios"}],mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"fenix",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Attribute"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_default_browser")),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"date_string")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"In YYYY-MM-DD format")))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in ",(0,l.kt)("a",{parentName:"p",href:"#missing-link"},"the code")," itself.")),(0,l.kt)(s.Z,{value:"fxios",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Attribute"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_default_browser")),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"date_string")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"In YYYY-MM-DD format")))),(0,l.kt)("p",null,"It is possible this table is out of date. The definitive source of truth for this in ",(0,l.kt)("a",{parentName:"p",href:"#missing-link"},"the code")," itself."))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"\u0420\u0443\u0441\u0441\u043a\u0438\u0439 \u0432\u043e\u0435\u043d\u043d\u044b\u0439 \u043a\u043e\u0440\u0430\u0431\u043b\u044c, \u0438\u0434\u0438 \u043d\u0430 \u0445\u0443\u0439\n")))}g.isMDXComponent=!0},6010:function(e,t,n){"use strict";function a(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function i(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(i&&(i+=" "),i+=t);return i}n.d(t,{Z:function(){return i}})},9537:function(e,t,n){"use strict";t.Z=n.p+"assets/images/branch-config-60db22b0fa5c8c429e1f39774fc8d31f.png"}}]);
"use strict";(globalThis.webpackChunkexperimenter_docs=globalThis.webpackChunkexperimenter_docs||[]).push([[9647],{5680(e,t,r){r.d(t,{xA:()=>u,yg:()=>m});var a=r(6540);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=a.createContext({}),p=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},y={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(r),m=n,f=c["".concat(s,".").concat(m)]||c[m]||y[m]||i;return r?a.createElement(f,l(l({ref:t},u),{},{components:r})):a.createElement(f,l({ref:t},u))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var p=2;p<i;p++)l[p]=r[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},9390(e,t,r){r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>y,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=r(8168),n=(r(6540),r(5680));const i={id:"experiment-lifecycle-faq",title:"Experiment Lifecycle",slug:"/faq/experiment-lifecycle",sidebar_position:2},l=void 0,o={unversionedId:"faq/experiment-lifecycle-faq",id:"faq/experiment-lifecycle-faq",title:"Experiment Lifecycle",description:"Common questions about experiment enrollment, timing, startup behavior, and ending experiments.",source:"@site/docs/faq/experiment-lifecycle.mdx",sourceDirName:"faq",slug:"/faq/experiment-lifecycle",permalink:"/faq/experiment-lifecycle",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/faq/experiment-lifecycle.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"experiment-lifecycle-faq",title:"Experiment Lifecycle",slug:"/faq/experiment-lifecycle",sidebar_position:2},sidebar:"sidebar",previous:{title:"Getting Started",permalink:"/faq/getting-started"},next:{title:"Rollouts",permalink:"/faq/rollouts"}},s={},p=[{value:"When a user receives a recipe, are they enrolled immediately or at the next session?",id:"when-a-user-receives-a-recipe-are-they-enrolled-immediately-or-at-the-next-session",level:2},{value:"If a client is unenrolled from an experiment (say they opt out of that experiment specifically) will they be able to enroll again if they meet the criteria?",id:"if-a-client-is-unenrolled-from-an-experiment-say-they-opt-out-of-that-experiment-specifically-will-they-be-able-to-enroll-again-if-they-meet-the-criteria",level:2},{value:"What Does Early Startup Do?",id:"what-does-early-startup-do",level:2},{value:"How Early is Early?",id:"how-early-is-early",level:2},{value:"Early on Desktop",id:"early-on-desktop",level:3},{value:"Early on Mobile",id:"early-on-mobile",level:3},{value:"Is feature restart supported?",id:"is-feature-restart-supported",level:2},{value:"What happens at experiment end?",id:"what-happens-at-experiment-end",level:2},{value:"If there is a problem and I need to abort the experiment and rollout, will cancelling the experiment and rollout revert the feature flags to their pre-experiment and pre-rollout states (i.e. feature is disabled) for all users enrolled so far?",id:"if-there-is-a-problem-and-i-need-to-abort-the-experiment-and-rollout-will-cancelling-the-experiment-and-rollout-revert-the-feature-flags-to-their-pre-experiment-and-pre-rollout-states-ie-feature-is-disabled-for-all-users-enrolled-so-far",level:3}],u={toc:p};function y(e){let{components:t,...r}=e;return(0,n.yg)("wrapper",(0,a.A)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"Common questions about experiment enrollment, timing, startup behavior, and ending experiments."),(0,n.yg)("hr",null),(0,n.yg)("h2",{id:"when-a-user-receives-a-recipe-are-they-enrolled-immediately-or-at-the-next-session"},"When a user receives a recipe, are they enrolled immediately or at the next session?"),(0,n.yg)("p",null,"For ",(0,n.yg)("a",{parentName:"p",href:"/advanced/first-run-experiments"},"first run experiments"),", the recipe is bundled with the app."),(0,n.yg)("p",null,"For existing users, the flow is:"),(0,n.yg)("blockquote",null,(0,n.yg)("p",{parentName:"blockquote"},"1) Firefox starts"),(0,n.yg)("p",{parentName:"blockquote"},"2) Existing enrollments are applied fast"),(0,n.yg)("p",{parentName:"blockquote"},"3) Browser continues to start"),(0,n.yg)("p",{parentName:"blockquote"},"4) Nimbus syncs and computes new enrollments"),(0,n.yg)("p",{parentName:"blockquote"},"5) New enrollment prefs are set")),(0,n.yg)("p",null,"So if your feature only reads prefs right at startup, then the pref wouldn't be applied until the following session."),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"You can use ",(0,n.yg)("inlineCode",{parentName:"p"},"isEarlyStartup")," to persist the prefs to disk so that they are available as soon as possible at startup.")),(0,n.yg)("hr",null),(0,n.yg)("h2",{id:"if-a-client-is-unenrolled-from-an-experiment-say-they-opt-out-of-that-experiment-specifically-will-they-be-able-to-enroll-again-if-they-meet-the-criteria"},"If a client is unenrolled from an experiment (say they opt out of that experiment specifically) will they be able to enroll again if they meet the criteria?"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"No"),". Once a user is disqualified by opting out (or through targeting, etc.) the client keeps a record of that and won't enroll back into the same experiment."),(0,n.yg)("hr",null),(0,n.yg)("h2",{id:"what-does-early-startup-do"},"What Does Early Startup Do?"),(0,n.yg)("p",null,'Include "isEarlyStartup" in the FeatureManifest.yaml if you need synchronous access / very early access at startup or if you are registering this to use for platform experiments.'),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"What does this do?")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"It caches the feature values to disk using temporary prefs so that they're available as soon as user prefs are initialized and loaded, so they're available earlier in browser initialization and also helps make them available to gecko more easily."),(0,n.yg)("li",{parentName:"ul"},"IsEarlyStartup means we persist the experiment data in prefs so you can a) use them from c++ or b) use the JS experiment API before we've loaded experiments from disk.")),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"So why don't I always use Early Startup to be sure my feature is controllable by an experiment early enough?")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"You have to reconcile storing state in multiple places, it's only needed for a specific set of features in specific circumstances, so for the rest of them it's much safer to not touch the pref store at all and only worry about a single source of state."),(0,n.yg)("li",{parentName:"ul"},"It also makes tests more annoying because if you don't clean them up properly it's easy to break adjacent tests")),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"There is info on how to use Early Startup ",(0,n.yg)("a",{parentName:"p",href:"/platform-guides/desktop/feature-api/#registering-a-new-feature"},"here in the documentation"))),(0,n.yg)("hr",null),(0,n.yg)("h2",{id:"how-early-is-early"},"How Early is Early?"),(0,n.yg)("h3",{id:"early-on-desktop"},"Early on Desktop"),(0,n.yg)("p",null,"The 'isEarlyStartup' flag for features will write variables to prefs to ensure data is available once prefs are loaded.\nNimbus uses its own internal prefs. If you're talking to Nimbus via JS you can just interact with it normally and it\nwill read from prefs if it hasn't yet loaded its data store. Then you can use the ",(0,n.yg)("a",{parentName:"p",href:"https://searchfox.org/mozilla-central/source/toolkit/components/nimbus/lib/NimbusFeatures.h"},"C++ API"),"."),(0,n.yg)("p",null,"You don't have to do anything special though, as long as isEarlyStartup is set it should Just Work.\nAssuming everything is main thread, you shouldn't have any issues."),(0,n.yg)("p",null,"First startup initializes Nimbus, which will then try to grab experiments and rollouts for all features (",(0,n.yg)("a",{parentName:"p",href:"https://searchfox.org/mozilla-central/rev/fb9a504ca73529fa550efe488db2a012a4bf5169/toolkit/modules/FirstStartup.sys.mjs#50"},"code"),").\nThis happens before we paint the first window. First startup blocks painting."),(0,n.yg)("h3",{id:"early-on-mobile"},"Early on Mobile"),(0,n.yg)("p",null,"TBD"),(0,n.yg)("hr",null),(0,n.yg)("h2",{id:"is-feature-restart-supported"},"Is feature restart supported?"),(0,n.yg)("p",null,"Yes! Feature restart is supported by Nimbus. This is how it works when a feature requires a restart:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Session 1:")," Client enrolls, applies feature configuration, but the feature itself won't implement the changes until the next restart"),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Session 2:")," Client is enrolled, feature configuration is applied, feature now shows changes")),(0,n.yg)("admonition",{title:"Important",type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"Please share that this experiment needs a restart in your data science Jira ticket and that there is custom work needed at analysis to exlude the pre-restart data.")),(0,n.yg)("hr",null),(0,n.yg)("h2",{id:"what-happens-at-experiment-end"},"What happens at experiment end?"),(0,n.yg)("p",null,"See the ",(0,n.yg)("a",{parentName:"p",href:"/workflow/ending"},"Experimentation Workflow")," for general information about ending experiments."),(0,n.yg)("h3",{id:"if-there-is-a-problem-and-i-need-to-abort-the-experiment-and-rollout-will-cancelling-the-experiment-and-rollout-revert-the-feature-flags-to-their-pre-experiment-and-pre-rollout-states-ie-feature-is-disabled-for-all-users-enrolled-so-far"},"If there is a problem and I need to abort the experiment and rollout, will cancelling the experiment and rollout revert the feature flags to their pre-experiment and pre-rollout states (i.e. feature is disabled) for all users enrolled so far?"),(0,n.yg)("p",null,"Ending means Nimbus stops applying the change, so users will go back to whatever state they would have without the experiment or rollout applied.  If you have a complex feature - you can verify by asking QA to test that scenario before release as well."))}y.isMDXComponent=!0}}]);
"use strict";(globalThis.webpackChunkexperimenter_docs=globalThis.webpackChunkexperimenter_docs||[]).push([[2943],{5680(e,a,t){t.d(a,{xA:()=>p,yg:()=>d});var n=t(6540);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),u=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},p=function(e){var a=u(e.components);return n.createElement(i.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=u(t),d=r,g=m["".concat(i,".").concat(d)]||m[d]||c[d]||l;return t?n.createElement(g,o(o({ref:a},p),{},{components:t})):n.createElement(g,o({ref:a},p))}));function d(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=m;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<l;u++)o[u]=t[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7227(e,a,t){t.d(a,{A:()=>o});var n=t(6540),r=t(870);const l="tabItem_Ymn6";function o(e){let{children:a,hidden:t,className:o}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.A)(l,o),hidden:t},a)}},9489(e,a,t){t.d(a,{A:()=>T});var n=t(8168),r=t(6540),l=t(870),o=t(4245),s=t(6347),i=t(2814),u=t(5167),p=t(1269);function c(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:a,label:t,attributes:n,default:r}}=e;return{value:a,label:t,attributes:n,default:r}}))}function m(e){const{values:a,children:t}=e;return(0,r.useMemo)((()=>{const e=a??c(t);return function(e){const a=(0,u.X)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,t])}function d(e){let{value:a,tabValues:t}=e;return t.some((e=>e.value===a))}function g(e){let{queryString:a=!1,groupId:t}=e;const n=(0,s.W6)(),l=function(e){let{queryString:a=!1,groupId:t}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:a,groupId:t});return[(0,i.aZ)(l),(0,r.useCallback)((e=>{if(!l)return;const a=new URLSearchParams(n.location.search);a.set(l,e),n.replace({...n.location,search:a.toString()})}),[l,n])]}function y(e){const{defaultValue:a,queryString:t=!1,groupId:n}=e,l=m(e),[o,s]=(0,r.useState)((()=>function(e){let{defaultValue:a,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!d({value:a,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:a,tabValues:l}))),[i,u]=g({queryString:t,groupId:n}),[c,y]=function(e){let{groupId:a}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(a),[n,l]=(0,p.Dv)(t);return[n,(0,r.useCallback)((e=>{t&&l.set(e)}),[t,l])]}({groupId:n}),f=(()=>{const e=i??c;return d({value:e,tabValues:l})?e:null})();(0,r.useLayoutEffect)((()=>{f&&s(f)}),[f]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!d({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);s(e),u(e),y(e)}),[u,y,l]),tabValues:l}}var f=t(1062);const h="tabList__CuJ",b="tabItem_LNqP";function v(e){let{className:a,block:t,selectedValue:s,selectValue:i,tabValues:u}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.a_)(),m=e=>{const a=e.currentTarget,t=p.indexOf(a),n=u[t].value;n!==s&&(c(a),i(n))},d=e=>{let a=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const t=p.indexOf(e.currentTarget)+1;a=p[t]??p[0];break}case"ArrowLeft":{const t=p.indexOf(e.currentTarget)-1;a=p[t]??p[p.length-1];break}}a?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":t},a)},u.map((e=>{let{value:a,label:t,attributes:o}=e;return r.createElement("li",(0,n.A)({role:"tab",tabIndex:s===a?0:-1,"aria-selected":s===a,key:a,ref:e=>p.push(e),onKeyDown:d,onClick:m},o,{className:(0,l.A)("tabs__item",b,o?.className,{"tabs__item--active":s===a})}),t??a)})))}function N(e){let{lazy:a,children:t,selectedValue:n}=e;const l=(Array.isArray(t)?t:[t]).filter(Boolean);if(a){const e=l.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},l.map(((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==n}))))}function w(e){const a=y(e);return r.createElement("div",{className:(0,l.A)("tabs-container",h)},r.createElement(v,(0,n.A)({},e,a)),r.createElement(N,(0,n.A)({},e,a)))}function T(e){const a=(0,f.A)();return r.createElement(w,(0,n.A)({key:String(a)},e))}},2835(e,a,t){t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>u,toc:()=>c});var n=t(8168),r=(t(6540),t(5680)),l=t(9489),o=t(7227);const s={id:"desktop-feature-api",title:"Feature API",slug:"/platform-guides/desktop/feature-api"},i=void 0,u={unversionedId:"platform-guides/desktop/desktop-feature-api",id:"platform-guides/desktop/desktop-feature-api",title:"Feature API",description:"This guide will help you use the Nimbus Feature API in Desktop Firefox to run experiments, set values remotely, and manage user preferences. If you are new to using Nimbus, here's a video overview of how the code interacts to control your feature.  The video until 5 minutes 44 seconds focuses on getting started.  Starting at 5:58 it switches to considerations when controlling preferences.",source:"@site/docs/platform-guides/desktop/feature-api.mdx",sourceDirName:"platform-guides/desktop",slug:"/platform-guides/desktop/feature-api",permalink:"/platform-guides/desktop/feature-api",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/platform-guides/desktop/feature-api.mdx",tags:[],version:"current",frontMatter:{id:"desktop-feature-api",title:"Feature API",slug:"/platform-guides/desktop/feature-api"},sidebar:"sidebar",previous:{title:"Feature Definition",permalink:"/technical-reference/feature-definition"},next:{title:"Pref Experiments",permalink:"/platform-guides/desktop/pref-experiments"}},p={},c=[{value:"About the Feature API",id:"about-the-feature-api",level:2},{value:"Can I Use This?",id:"can-i-use-this",level:3},{value:"What is a feature?",id:"what-is-a-feature",level:3},{value:"Configuration sources",id:"configuration-sources",level:2},{value:"Registering a new feature",id:"registering-a-new-feature",level:2},{value:"Importing the Feature API",id:"importing-the-feature-api",level:2},{value:"API Reference Guide",id:"api-reference-guide",level:2},{value:"<code>getVariable()</code>",id:"getvariable",level:3},{value:"<code>getAllVariables()</code>",id:"getallvariables",level:3},{value:"<code>recordExposureEvent()</code>",id:"recordexposureevent",level:3},{value:"<code>ready()</code>",id:"ready",level:3},{value:"<code>onUpdate()</code>",id:"onupdate",level:3},{value:"<code>offUpdate()</code>",id:"offupdate",level:3},{value:"<code>getEnrollmentMetadata()</code>",id:"getenrollmentmetadata",level:3},{value:"<code>getAllEnrollments()</code>",id:"getallenrollments",level:3},{value:"<code>getAllEnrollmentMetadata()</code>",id:"getallenrollmentmetadata",level:3}],m={toc:c};function d(e){let{components:a,...t}=e;return(0,r.yg)("wrapper",(0,n.A)({},m,t,{components:a,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"This guide will help you use the Nimbus Feature API in Desktop Firefox to run experiments, set values remotely, and manage user preferences. If you are new to using Nimbus, here's a ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("a",{parentName:"strong",href:"https://mozilla.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=45529d6a-27d4-42c4-891c-b22d016cfdd3"},"video overview of how the code interacts to control your feature")),".  The video until 5 minutes 44 seconds focuses on getting started.  Starting at 5:58 it switches to considerations when controlling preferences."),(0,r.yg)("p",null,"If you are familiar with Normandy and are trying to migrate a feature, you may want to check out the ",(0,r.yg)("a",{parentName:"p",href:"/platform-guides/desktop/migration-guide"},"Migration Guide for Pref Experiments"),"."),(0,r.yg)("h2",{id:"about-the-feature-api"},"About the Feature API"),(0,r.yg)("h3",{id:"can-i-use-this"},"Can I Use This?"),(0,r.yg)("p",null,"For the JS implementation you can import ",(0,r.yg)("inlineCode",{parentName:"p"},"ExperimentAPI.sys.mjs")," in the parent process or a privileged child process. We ",(0,r.yg)("em",{parentName:"p"},"do")," support First run experiments on Windows, holdbacks, and rollouts."),(0,r.yg)("p",null,"For the C++ implementation you can import ",(0,r.yg)("inlineCode",{parentName:"p"},'#include "mozilla/browser/NimbusFeatures.h"')," and we support early startup experiments and holdbacks."),(0,r.yg)("p",null,"If you have a usecase that isn't supported, please reach out in #ask-experimenter on Slack."),(0,r.yg)("h3",{id:"what-is-a-feature"},"What is a feature?"),(0,r.yg)("p",null,"In the Nimbus ecosystem, a ",(0,r.yg)("inlineCode",{parentName:"p"},"feature")," is an area of code instrumented for experiments and remote configuration. It can be as small as a single function or as complex as a whole about: page. Some examples:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"aboutwelcome"),", The about:welcome page in Desktop"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"newtab"),", The about:newtab page in Desktop")),(0,r.yg)("p",null,"In your code, you will use the Nimbus SDK to access variables associated with those features. e.g."),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const { screens, skipFocus } = NimbusFeatures.aboutwelcome.getAllVariables();\n"))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'NimbusFeatures::GetBool("aboutwelcome"_ns, "enabled"_ns, false);\n')))),(0,r.yg)("h2",{id:"configuration-sources"},"Configuration sources"),(0,r.yg)("admonition",{title:"Note",type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"This section is relevant only for the JS API.")),(0,r.yg)("p",null,"The Nimbus Feature API will return the correct configuration for a feature given a few different inputs ",(0,r.yg)("strong",{parentName:"p"},"in this order"),":"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Experiment value"),": First, we check if a Nimbus experiment is activated that changes the feature."),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Remotely-configured value"),": If no experiment is set, we check if there is a remotely-defined value. This is a mechanism that allows us to roll-out changes quickly between releases."),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Local default"),": Finally, we will return the current value of preferences in the manifest, if they are defined in ",(0,r.yg)("a",{parentName:"li",href:"https://searchfox.org/mozilla-central/source/browser/app/profile/firefox.js"},"firefox.js"),".")),(0,r.yg)("h2",{id:"registering-a-new-feature"},"Registering a new feature"),(0,r.yg)("p",null,"To register a new feature, you will need to choose an identifier and add it to the manifest in ",(0,r.yg)("a",{parentName:"p",href:"https://searchfox.org/mozilla-central/source/toolkit/components/nimbus/FeatureManifest.yaml"},"FeatureManifest.yaml"),":\nAfter adding the feature a build step is required to update the appropriate header file."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'# In FeatureManifest.yaml\n# Our feature name\naboutwelcome:\n  description: The about:welcome page\n  owner: user@mozilla.com\n  hasExposure: true\n  exposureDescription: >\n    Recorded when the about:welcome page is first shown to the user.\n  # Include this if you need synchronous access / very early access at startup\n  # or if you are registering this to use for platform experiments.\n  isEarlyStartup: true\n  # Set to true to allow a client to be enrolled in multiple experiments/rollouts\n  # for this feature simultaneously. See "Co-enrolling Features" docs.\n  # allowCoenrollment: false\n  variables:\n    # Additional (optional) values that we can control\n    # The name of these variables is up to you\n    enabled:\n      type: boolean\n      fallbackPref: browser.aboutwelcome.enabled\n    skipFocus:\n      type: boolean\n')),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},'// In firefox.js\npref("browser.aboutwelcome.enabled", true);\n')),(0,r.yg)("h2",{id:"importing-the-feature-api"},"Importing the Feature API"),(0,r.yg)("p",null,"Import the ",(0,r.yg)("inlineCode",{parentName:"p"},"NimbusFeatures")," module:"),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'const lazy = {}\nChromeUtils.defineESModuleGetters(lazy, {\n  NimbusFeatures: "resource://nimbus/ExperimentAPI.sys.mjs",\n});\n'))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "mozilla/browser/NimbusFeatures.h"\n')))),(0,r.yg)("h2",{id:"api-reference-guide"},"API Reference Guide"),(0,r.yg)("h3",{id:"getvariable"},(0,r.yg)("inlineCode",{parentName:"h3"},"getVariable()")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"getVariable(variableName: string): FeatureValue")),(0,r.yg)("p",null,"Returns the value of a single feature variable."),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'// Warning: **This function will throw in Nightly and CI build** if you do not define `variableName` in the Nimbus manifest.\n\nconst foo = NimbusFeatures.myFeature.getVariable("foo");\n\n// notAVariable is not defined in the manifest, so this will throw in CI\nconst baz = NimbusFeatures.myFeature.getVariable("notAVariable");\n'))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'// feature name and variable name to retrieve the value\nNimbusFeatures::GetInt("aboutwelcome"_ns, "skipFocus"_ns, false);\n')))),(0,r.yg)("h3",{id:"getallvariables"},(0,r.yg)("inlineCode",{parentName:"h3"},"getAllVariables()")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"getAllVariables({ defaultValues }): FeatureValue")," (JS Only)"),(0,r.yg)("p",null,"Returns the value of all variables for a feature. Note that ",(0,r.yg)("strong",{parentName:"p"},"variables will be merged between sources"),"."),(0,r.yg)("p",null,"If ",(0,r.yg)("inlineCode",{parentName:"p"},"options.defaultValues")," is defined, it will be preferred before default branch fallback values but after experiment, remote, and user-set preference values."),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const { foo, bar } = NimbusFeatures.myFeature.getAllVariables({\n  defaultValues: { foo: true, bar: false },\n});\n"))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'// There is no equivalent for this in C++. Instead you can use\n// NimbusFeatures::GetInt("featurename"_ns, "variablename"_ns, 0)\n// NimbusFeatures::GetBool("featurename"_ns, "variablename"_ns, false)\n// To access a single variable value at a time\n')))),(0,r.yg)("h3",{id:"recordexposureevent"},(0,r.yg)("inlineCode",{parentName:"h3"},"recordExposureEvent()")),(0,r.yg)("p",null,"Use this to send an ",(0,r.yg)("a",{parentName:"p",href:"/data-analysis/jetstream/overview#enrollment-vs-exposure"},"exposure event"),". By default this will send one exposure event per function call, but you can add an options object of ",(0,r.yg)("inlineCode",{parentName:"p"},"{once: true}")," to only send it once per session."),(0,r.yg)("p",null,"Note that you should add an ",(0,r.yg)("inlineCode",{parentName:"p"},"exposureDescription")," to the manifest describing when/how this event is sent."),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'NimbusFeatures.myFeature.recordExposureEvent();\n\n// Only sends once per session, even if this function is called multiple times\nNimbusFeatures.myFeature.recordExposureEvent({ once: true });\n\n// For co-enrolling features, you must specify which enrollment to record exposure for:\nNimbusFeatures.myFeature.recordExposureEvent({ slug: "experiment-slug" });\nNimbusFeatures.myFeature.recordExposureEvent({ once: true, slug: "experiment-slug" });\n'))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'// aOnce=true specifies that we only want to send this event once per browsing\n// session\nNimbusFeatures::RecordExposureEvent("featurename"_ns, true);\n')))),(0,r.yg)("h3",{id:"ready"},(0,r.yg)("inlineCode",{parentName:"h3"},"ready()")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"ready(): Promise")," (JS Only)"),(0,r.yg)("p",null,"Wait for the remote experiment and defaults stores to be synced before checking values."),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"await NimbusFeatures.myFeature.ready();\nconst { foo } = NimbusFeatures.myFeature.getAllVariables();\n"))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},"// This is not needed by the C++ API and has no equivalent, instead by\n// registering your feature as `isEarlyStartup` you can ensure that `GetBool`\n// and `GetInt` will return the experiment value at startup\n")))),(0,r.yg)("h3",{id:"onupdate"},(0,r.yg)("inlineCode",{parentName:"h3"},"onUpdate()")),(0,r.yg)("p",null,"Listen for changes, include to remote defaults or pref values."),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"NimbusFeatures.myFeature.onUpdate((event, reason) => {\n  /**\n   * `reason` is a string that can be used to identify the source\n   * of the update event.\n   * This list of reasons:\n   * 1. `feature-experiment-loaded` or `feature-rollout-loaded` this\n   * is triggered when the Nimbus feature has finished loading\n   * (when .ready() resolves). It is not relevant for isEarlyStartup=true features\n   * 2. `experiment-updated` or `rollout-updated` client recipe for this\n   * feature was changed (activated or deactivated)\n   * 3. `pref-updated` the value of the fallback pref for the feature\n   * variable was changed\n   */\n  const newValue = NimbusFeatures.myFeature.getAllVariables();\n  updateUI(newValue);\n});\n"))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'NimbusFeatures::OnUpdate("aboutwelcome"_ns, "skipFocus"_ns,\n  [](const char*, void*){}, void*);\n')))),(0,r.yg)("h3",{id:"offupdate"},(0,r.yg)("inlineCode",{parentName:"h3"},"offUpdate()")),(0,r.yg)("p",null,"Stop listening for changes."),(0,r.yg)(l.A,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.yg)(o.A,{value:"js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"NimbusFeatures.myFeature.onUpdate(aListener);\n\n// Later\nNimbusFeatures.myFeature.offUpdate(aListener);\n"))),(0,r.yg)(o.A,{value:"cpp",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'// Provide feature name and value to watch for changes\nNimbusFeatures::OnUpdate("aboutwelcome"_ns, "skipFocus"_ns,\n  [](const char*, void*){}, void*);\n\n\n// Later\nNimbusFeatures::OffUpdate("aboutwelcome"_ns, "skipFocus"_ns,\n  [](const char*, void*){}, void*);\n')))),(0,r.yg)("h3",{id:"getenrollmentmetadata"},(0,r.yg)("inlineCode",{parentName:"h3"},"getEnrollmentMetadata()")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"getEnrollmentMetadata(enrollmentType?: EnrollmentType): { slug: string, branch: string, isRollout: boolean } | null")," (JS Only)"),(0,r.yg)("p",null,"Returns metadata about the active enrollment for this feature, or ",(0,r.yg)("inlineCode",{parentName:"p"},"null")," if there is no active enrollment."),(0,r.yg)("p",null,"The optional ",(0,r.yg)("inlineCode",{parentName:"p"},"enrollmentType")," parameter controls what kind of enrollment to look for:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"No argument")," (default) \u2014 returns the active experiment if one exists, otherwise falls back to the active rollout."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"strong"},"EnrollmentType.EXPERIMENT"))," \u2014 returns only an active experiment enrollment, or ",(0,r.yg)("inlineCode",{parentName:"li"},"null"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"strong"},"EnrollmentType.ROLLOUT"))," \u2014 returns only an active rollout enrollment, or ",(0,r.yg)("inlineCode",{parentName:"li"},"null"),".")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'// EnrollmentType is exported from the same module as NimbusFeatures:\n// ChromeUtils.defineESModuleGetters(lazy, {\n//   EnrollmentType: "resource://nimbus/ExperimentAPI.sys.mjs",\n// });\n\nconst data = NimbusFeatures.myFeature.getEnrollmentMetadata();\n\n// If there is no enrollment, data will be null.\nif (data) {\n  sendSomeTelemetry(\n    `Enrolled in ${data.slug}, branch: ${data.branch}, isRollout: ${data.isRollout}`,\n  );\n}\n\n// Query for a specific enrollment type:\nconst rollout = NimbusFeatures.myFeature.getEnrollmentMetadata(lazy.EnrollmentType.ROLLOUT);\n')),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"This method throws for ",(0,r.yg)("a",{parentName:"p",href:"/technical-reference/fml/coenrolling-features"},"co-enrolling features"),". Use ",(0,r.yg)("inlineCode",{parentName:"p"},"getAllEnrollmentMetadata()")," instead.")),(0,r.yg)("h3",{id:"getallenrollments"},(0,r.yg)("inlineCode",{parentName:"h3"},"getAllEnrollments()")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"getAllEnrollments(): { meta: { slug, branch, isRollout }, value: object }[]")," (JS Only)"),(0,r.yg)("p",null,"Returns an array of all active enrollments for this feature, each with metadata and the resolved feature variable values. This is the primary data access method for ",(0,r.yg)("a",{parentName:"p",href:"/technical-reference/fml/coenrolling-features"},"co-enrolling features")," where a client may be enrolled in multiple experiments and/or rollouts for the same feature simultaneously."),(0,r.yg)("p",null,"For non-co-enrolling features, this also works but will return at most two entries (one experiment and one rollout)."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const enrollments = NimbusFeatures.myFeature.getAllEnrollments();\n\nfor (const { meta, value } of enrollments) {\n  console.log(`${meta.slug} (branch: ${meta.branch}):`, value);\n}\n")),(0,r.yg)("h3",{id:"getallenrollmentmetadata"},(0,r.yg)("inlineCode",{parentName:"h3"},"getAllEnrollmentMetadata()")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"getAllEnrollmentMetadata(): { slug: string, branch: string, isRollout: boolean }[]")," (JS Only)"),(0,r.yg)("p",null,"Returns metadata for all active enrollments for this feature, without the resolved feature values. Use this when you only need enrollment identifiers (e.g., for telemetry) and not the feature configuration."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const enrollments = NimbusFeatures.myFeature.getAllEnrollmentMetadata();\n\nfor (const { slug, branch, isRollout } of enrollments) {\n  sendSomeTelemetry(`Enrolled in ${slug}, branch: ${branch}`);\n}\n")))}d.isMDXComponent=!0}}]);
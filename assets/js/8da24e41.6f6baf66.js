"use strict";(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[1441],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>f});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var u=n.createContext({}),o=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=o(e.components);return n.createElement(u.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,u=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=o(a),m=r,f=c["".concat(u,".").concat(m)]||c[m]||d[m]||l;return a?n.createElement(f,s(s({ref:t},p),{},{components:a})):n.createElement(f,s({ref:t},p))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,s=new Array(l);s[0]=m;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i[c]="string"==typeof e?e:r,s[1]=i;for(var o=2;o<l;o++)s[o]=a[o];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(7294),r=a(6010);const l={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:a,className:s}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(l.tabItem,s),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>N});var n=a(7462),r=a(7294),l=a(6010),s=a(2466),i=a(6550),u=a(1980),o=a(7392),p=a(12);function c(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function d(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??c(a);return function(e){const t=(0,o.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function m(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:a}=e;const n=(0,i.k6)(),l=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,u._X)(l),(0,r.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(n.location.search);t.set(l,e),n.replace({...n.location,search:t.toString()})}),[l,n])]}function b(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,l=d(e),[s,i]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:l}))),[u,o]=f({queryString:a,groupId:n}),[c,b]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,l]=(0,p.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&l.set(e)}),[a,l])]}({groupId:n}),h=(()=>{const e=u??c;return m({value:e,tabValues:l})?e:null})();(0,r.useLayoutEffect)((()=>{h&&i(h)}),[h]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);i(e),o(e),b(e)}),[o,b,l]),tabValues:l}}var h=a(2389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:t,block:a,selectedValue:i,selectValue:u,tabValues:o}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.o5)(),d=e=>{const t=e.currentTarget,a=p.indexOf(t),n=o[a].value;n!==i&&(c(t),u(n))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=p.indexOf(e.currentTarget)+1;t=p[a]??p[0];break}case"ArrowLeft":{const a=p.indexOf(e.currentTarget)-1;t=p[a]??p[p.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":a},t)},o.map((e=>{let{value:t,label:a,attributes:s}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>p.push(e),onKeyDown:m,onClick:d},s,{className:(0,l.Z)("tabs__item",g.tabItem,s?.className,{"tabs__item--active":i===t})}),a??t)})))}function k(e){let{lazy:t,children:a,selectedValue:n}=e;const l=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=l.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},l.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function y(e){const t=b(e);return r.createElement("div",{className:(0,l.Z)("tabs-container",g.tabList)},r.createElement(v,(0,n.Z)({},e,t)),r.createElement(k,(0,n.Z)({},e,t)))}function N(e){const t=(0,h.Z)();return r.createElement(y,(0,n.Z)({key:String(t)},e))}},604:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>u,default:()=>f,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var n=a(7462),r=(a(7294),a(3905)),l=a(4866),s=a(5162);const i={id:"desktop-feature-api",title:"Desktop Feature API (JS and C++)",slug:"/desktop-feature-api"},u=void 0,o={unversionedId:"getting-started/engineers/desktop-feature-api",id:"getting-started/engineers/desktop-feature-api",title:"Desktop Feature API (JS and C++)",description:"This guide will help you use the Nimbus Feature API in Desktop Firefox to run experiments, set values remotely, and manage user preferences. If you are familiar with Normandy and are trying to migrate a feature, you may want to check out the Migration Guide for Pref Experiments.",source:"@site/docs/getting-started/engineers/desktop-feature-api.mdx",sourceDirName:"getting-started/engineers",slug:"/desktop-feature-api",permalink:"/desktop-feature-api",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/getting-started/engineers/desktop-feature-api.mdx",tags:[],version:"current",frontMatter:{id:"desktop-feature-api",title:"Desktop Feature API (JS and C++)",slug:"/desktop-feature-api"},sidebar:"sidebar",previous:{title:"Getting Started for iOS Engineers",permalink:"/getting-started/engineers/getting-started-for-ios-engineers"},next:{title:"Desktop Migration Guide (JS)",permalink:"/desktop-migration-guide"}},p={},c=[{value:"About the Feature API",id:"about-the-feature-api",level:2},{value:"Can I use this?",id:"can-i-use-this",level:3},{value:"What is a feature?",id:"what-is-a-feature",level:3},{value:"Configuration sources",id:"configuration-sources",level:2},{value:"Registering a new feature",id:"registering-a-new-feature",level:2},{value:"Importing the Feature API",id:"importing-the-feature-api",level:2},{value:"API Reference Guide",id:"api-reference-guide",level:2},{value:"<code>getVariable()</code>",id:"getvariable",level:3},{value:"<code>getAllVariables()</code>",id:"getallvariables",level:3},{value:"<code>recordExposureEvent()</code>",id:"recordexposureevent",level:3},{value:"<code>ready()</code>",id:"ready",level:3},{value:"<code>onUpdate()</code>",id:"onupdate",level:3},{value:"<code>off()</code>",id:"off",level:3},{value:"Experiment Metadata",id:"experiment-metadata",level:2}],d={toc:c},m="wrapper";function f(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide will help you use the Nimbus Feature API in Desktop Firefox to run experiments, set values remotely, and manage user preferences. If you are familiar with Normandy and are trying to migrate a feature, you may want to check out the ",(0,r.kt)("a",{parentName:"p",href:"/desktop-migration-guide"},"Migration Guide for Pref Experiments"),"."),(0,r.kt)("h2",{id:"about-the-feature-api"},"About the Feature API"),(0,r.kt)("h3",{id:"can-i-use-this"},"Can I use this?"),(0,r.kt)("p",null,"For the JS implementation you can import ",(0,r.kt)("inlineCode",{parentName:"p"},"ExperimentAPI.jsm")," in the parent process or a privileged child process. We ",(0,r.kt)("em",{parentName:"p"},"do")," support First run experiments on Windows, holdbacks, and rollouts."),(0,r.kt)("p",null,"For the C++ implementation you can import ",(0,r.kt)("inlineCode",{parentName:"p"},'#include "mozilla/browser/NimbusFeatures.h"')," and we support early startup experiments and holdbacks."),(0,r.kt)("p",null,"If you have a usecase that isn't supported, please reach out in #ask-experimenter on Slack."),(0,r.kt)("h3",{id:"what-is-a-feature"},"What is a feature?"),(0,r.kt)("p",null,"In the Nimbus ecosystem, a ",(0,r.kt)("inlineCode",{parentName:"p"},"feature")," is an area of code instrumented for experiments and remote configuration. It can be as small as a single function or as complex as a whole about: page. Some examples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"aboutwelcome"),", The about:welcome page in Desktop"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"newtab"),", The about:newtab page in Desktop")),(0,r.kt)("p",null,"In your code, you will use the Nimbus SDK to access variables associated with those features. e.g."),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { screens, skipFocus } = NimbusFeatures.aboutwelcome.getAllVariables();\n"))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'NimbusFeatures::GetBool("aboutwelcome"_ns, "enabled"_ns, false);\n')))),(0,r.kt)("h2",{id:"configuration-sources"},"Configuration sources"),(0,r.kt)("admonition",{title:"Note",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"This section is relevant only for the JS API.")),(0,r.kt)("p",null,"The Nimbus Feature API will return the correct configuration for a feature given a few different inputs ",(0,r.kt)("strong",{parentName:"p"},"in this order"),":"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Experiment value"),": First, we check if a Nimbus experiment is activated that changes the feature."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Remotely-configured value"),": If no experiment is set, we check if there is a remotely-defined value. This is a mechanism that allows us to roll-out changes quickly between releases."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Local default"),": Finally, we will return the current value of preferences in the manifest, if they are defined in ",(0,r.kt)("a",{parentName:"li",href:"https://searchfox.org/mozilla-central/source/browser/app/profile/firefox.js"},"firefox.js"),".")),(0,r.kt)("h2",{id:"registering-a-new-feature"},"Registering a new feature"),(0,r.kt)("p",null,"To register a new feature, you will need to choose an identifier and add it to the manifest in ",(0,r.kt)("a",{parentName:"p",href:"https://searchfox.org/mozilla-central/source/toolkit/components/nimbus/FeatureManifest.yaml"},"FeatureManifest.yaml"),":\nAfter adding the feature a build step is required to update the appropriate header file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# In FeatureManifest.yaml\n# Our feature name\naboutwelcome:\n  description: The about:welcome page\n  # Include this if you need synchronous access / very early access at startup\n  # or if you are registering this to use for platform experiments.\n  isEarlyStartup: true\n  variables:\n    # Additional (optional) values that we can control\n    # The name of these variables is up to you\n    enabled:\n      type: boolean\n      fallbackPref: browser.aboutwelcome.enabled\n    skipFocus:\n      type: boolean\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// In firefox.js\npref("browser.aboutwelcome.enabled", true);\n')),(0,r.kt)("h2",{id:"importing-the-feature-api"},"Importing the Feature API"),(0,r.kt)("p",null,"Import the ",(0,r.kt)("inlineCode",{parentName:"p"},"NimbusFeatures")," module:"),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'XPCOMUtils.defineLazyModuleGetters(this, {\n  NimbusFeatures: "resource://nimbus/ExperimentAPI.jsm",\n});\n'))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'#include "mozilla/browser/NimbusFeatures.h"\n')))),(0,r.kt)("h2",{id:"api-reference-guide"},"API Reference Guide"),(0,r.kt)("h3",{id:"getvariable"},(0,r.kt)("inlineCode",{parentName:"h3"},"getVariable()")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"getVariable(variableName: string): FeatureValue")),(0,r.kt)("p",null,"Returns the value of a single feature variable."),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// Warning: **This function will throw in Nightly and CI build** if you do not define `variableName` in the Nimbus manifest.\n\nconst foo = NimbusFeatures.myFeature.getVariable("foo");\n\n// notAVariable is not defined in the manifest, so this will throw in CI\nconst baz = NimbusFeatures.myFeature.getVariable("notAVariable");\n'))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'// feature name and variable name to retrieve the value\nNimbusFeatures::GetInt("aboutwelcome"_ns, "skipFocus"_ns, false);\n')))),(0,r.kt)("h3",{id:"getallvariables"},(0,r.kt)("inlineCode",{parentName:"h3"},"getAllVariables()")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"getAllVariables({ defaultValues }): FeatureValue")," (JS Only)"),(0,r.kt)("p",null,"Returns the value of all variables for a feature. Note that ",(0,r.kt)("strong",{parentName:"p"},"variables will be merged between sources"),"."),(0,r.kt)("p",null,"If ",(0,r.kt)("inlineCode",{parentName:"p"},"options.defaultValues")," is defined, it will be preferred before default branch fallback values but after experiment, remote, and user-set preference values."),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { foo, bar } = NimbusFeatures.myFeature.getAllVariables({\n  defaultValues: { foo: true, bar: false },\n});\n"))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'// There is no equivalent for this in C++. Instead you can use\n// NimbusFeatures::GetInt("featurename"_ns, "variablename"_ns, 0)\n// NimbusFeatures::GetBool("featurename"_ns, "variablename"_ns, false)\n// To access a single variable value at a time\n')))),(0,r.kt)("h3",{id:"recordexposureevent"},(0,r.kt)("inlineCode",{parentName:"h3"},"recordExposureEvent()")),(0,r.kt)("p",null,"Use this to send an ",(0,r.kt)("a",{parentName:"p",href:"/jetstream/jetstream/#enrollment-vs-exposure"},"exposure event"),". By default this will send one exposure event per function call, but you can add an options object of ",(0,r.kt)("inlineCode",{parentName:"p"},"{once: true}")," to only send it once per session."),(0,r.kt)("p",null,"Note that you should add an ",(0,r.kt)("inlineCode",{parentName:"p"},"exposureDescription")," to the manifest describing when/how this event is sent."),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"NimbusFeatures.myFeature.recordExposureEvent();\n\n// Only sends once per session, even if this function is called multiple times\nNimbusFeatures.myFeature.recordExposureEvent({ once: true });\n"))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'// aOnce=true specifies that we only want to send this event once per browsing\n// session\nNimbusFeatures::RecordExposureEvent("featurename"_ns, true);\n')))),(0,r.kt)("h3",{id:"ready"},(0,r.kt)("inlineCode",{parentName:"h3"},"ready()")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ready(): Promise")," (JS Only)"),(0,r.kt)("p",null,"Wait for the remote experiment and defaults stores to be synced before checking values."),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"await NimbusFeatures.myFeature.ready();\nconst { foo } = NimbusFeatures.myFeature.getAllVariables();\n"))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"// This is not needed by the C++ API and has no equivalent, instead by\n// registering your feature as `isEarlyStartup` you can ensure that `GetBool`\n// and `GetInt` will return the experiment value at startup\n")))),(0,r.kt)("h3",{id:"onupdate"},(0,r.kt)("inlineCode",{parentName:"h3"},"onUpdate()")),(0,r.kt)("p",null,"Listen for changes, include to remote defaults or pref values."),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"NimbusFeatures.myFeature.onUpdate((event, reason) => {\n  /**\n   * `reason` is a string that can be used to identify the source\n   * of the update event.\n   * This list of reasons:\n   * 1. `feature-experiment-loaded` or `feature-rollout-loaded` this\n   * is triggered when the Nimbus feature has finished loading\n   * (when .ready() resolves). It is not relevant for isEarlyStartup=true features\n   * 2. `experiment-updated` or `rollout-updated` client recipe for this\n   * feature was changed (activated or deactivated)\n   * 3. `pref-updated` the value of the fallback pref for the feature\n   * variable was changed\n   */\n  const newValue = NimbusFeatures.myFeature.getAllVariables();\n  updateUI(newValue);\n});\n"))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'NimbusFeatures::OnUpdate("aboutwelcome"_ns, "skipFocus"_ns,\n  [](const char*, void*){}, void*);\n')))),(0,r.kt)("h3",{id:"off"},(0,r.kt)("inlineCode",{parentName:"h3"},"off()")),(0,r.kt)("p",null,"Stop listening for changes."),(0,r.kt)(l.Z,{defaultValue:"js",values:[{label:"JavaScript",value:"js"},{label:"C++",value:"cpp"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"NimbusFeatures.myFeature.onUpdate(aListener);\n\n// Later\nNimbusFeatures.myFeature.off(aListener);\n"))),(0,r.kt)(s.Z,{value:"cpp",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'// Provide feature name and value to watch for changes\nNimbusFeatures::OnUpdate("aboutwelcome"_ns, "skipFocus"_ns,\n  [](const char*, void*){}, void*);\n\n\n// Later\nNimbusFeatures::OffUpdate("aboutwelcome"_ns, "skipFocus"_ns,\n  [](const char*, void*){}, void*);\n')))),(0,r.kt)("h2",{id:"experiment-metadata"},"Experiment Metadata"),(0,r.kt)("p",null,"If you need to know whether an experiment is active or get access to the experiment or branch identifier (for example, to report in ",(0,r.kt)("inlineCode",{parentName:"p"},"utm_params"),"), you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"ExperimentAPI.getExperimentMetaData"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'XPCOMUtils.defineLazyModuleGetters(this, {\n  ExperimentAPI: "resource://nimbus/ExperimentAPI.jsm",\n});\n\nconst data = ExperimentAPI.getExperimentMetaData({ featureId: "myFeature" });\n\n// If there is no experiment, data will be null.\nconst slug = data?.slug;\nconst branchSlug = data?.branch?.slug;\n\nif (experimentSlug && branchSlug) {\n  sendSomeTelemetry(\n    `The experiment identifier is ${slug} and the branch identifier is ${branchSlug}`,\n  );\n}\n')))}f.isMDXComponent=!0}}]);
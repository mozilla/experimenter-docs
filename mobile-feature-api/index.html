<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Mobile Feature API | Experimenter Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/mobile-feature-api"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Mobile Feature API | Experimenter Docs"><meta data-react-helmet="true" name="description" content="About this document"><meta data-react-helmet="true" property="og:description" content="About this document"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/mobile-feature-api"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/mobile-feature-api" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/mobile-feature-api" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4e4a976a.css">
<link rel="preload" href="/assets/js/runtime~main.04177c4c.js" as="script">
<link rel="preload" href="/assets/js/main.b9c9d506.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Mozilla Experimentation and Feature Delivery</b></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Nimbus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://mana.mozilla.org/wiki/display/FJT/Project+Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Mana<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Welcome</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What&#x27;s Newsletter</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/access">Experiment Reviewers</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Data Scientists</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Engineers</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/for-engineers">Engineers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/desktop-migration-guide">Desktop Migration Guide (JS)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/desktop-feature-api">Desktop Feature API (JS and C++)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mobile-feature-api">Mobile Feature API</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/for-product">Product Managers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/for-leadership">Leadership</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Workflow</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Deep Dives</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Jetstream</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Data topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Desktop topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Mobile topics</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mobile-feature-api">Mobile Feature API</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-surveys">Mobile Surveys</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Experimenter topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Specifications</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Cookbook</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Additional Links</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Frequently Asked Questions</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Feature Variables and Me</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="about-this-document"></a>About this document<a class="hash-link" href="#about-this-document" title="Direct link to heading">#</a></h2><p>This document is to illustrate the concepts of the Feature Variables feature of Nimbus, internally known as the Feature API.</p><p>The API used by software engineers is relatively small, so this document is not just for them. This document is also for designers, product managers and engineering managers who design, work on, and are responsible for features in the mobile apps we build. Successful experimentation requires multiple parts of the team to share an understanding of these concepts.</p><blockquote><p>üëã Information</p><p>Neither Nimbus, nor all of the Feature Variables work are finished yet, but they are certainly still useful. This document will talk about features that aren&#x27;t yet implemented, but will serve to illustrate the concepts. A sidebar like this will tell you when a feature isn&#x27;t ready.</p></blockquote><blockquote><p>‚õÖÔ∏èüî¨üî≠ Nomenclature</p><p>Much of the literature around the methodology of experiments Nimbus implements has its roots in medical testing. The feature variables API does not require understanding of double blind experiments or data-science, but this document will occasionally use words like &quot;treatment&quot; or &quot;exposure&quot;.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>The &quot;Feature&quot; in the &quot;Feature Variables API&quot; refers to features of the application. It&#x27;s pretty abstract, and how the application is divided up into features is up to the product teams. Over time, a feature may be involved in many experiments.</p><p>However, there is one rule:</p><blockquote><p>‚õÖÔ∏èüî¨üî≠ Concept</p><p><em>For a given user each feature can only be involved in one experiment at a time</em>.</p><p>If we see user change behavior after being exposed to an experimental treatment we need to be able to attribute it to that treatment, not another from a different experiment.</p></blockquote><p>One easy way to start thinking about features, would be to identify user-visible surfaces of the app: the <code>new-tab</code> screen, the <code>app-menu</code>, the <code>context-menu</code>, the <code>onboarding</code>.</p><p>Imagine you&#x27;re a designer, doing a re-design of the app&#x27;s menu. It would be natural to call the app menu a &quot;feature&quot; of the app.</p><p>You&#x27;ve got some hypotheses around the icons, and whether they should be to right or left of the text. There is also some uncertainty around the copy for each menu item.</p><p>The uncertainties and hypotheses you have might translate into variations and variables you might configure the menu with. If these variables and variations are documented, they should travel as an adjunct to or part of the design itself. Later these will be turned into a more formal document that lives with the code, but it is at this stage when they should be thought about.</p><p>To narrow the scope for documentation purposes, we&#x27;ll focus on a small number of variables. Within the <code>app-menu</code> feature, we&#x27;ll consider the menu being made up of menu items, and we&#x27;ll zoom in on the settings menu item.</p><p>As a team communication tool, it may help to consider a JSON object to enumerate the variables that are configurable for the settings icon, and their defaults.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://settings&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This JSON object looks like what experimenters will be putting into branch configuration screens in Experimenter, under Feature Configuration.</p><p>Where did these keys come from? This is not up to Nimbus, but up to the app, i.e. the app team. In this hypothetical case, you have some theories about the title and the icon, and now the app needs to get those values from nimbus.</p><blockquote><p>‚õÖÔ∏èüî¨üî≠  Naming Convention</p><p>Nimbus doesn&#x27;t take a view on how you arrange the JSON, but by convention, like all other identifiers, it prefers kebab-case (i.e. lower-case-words-joined-with-dashes).</p></blockquote><p>In the app code, the <code>Variables</code> object is a wrapper around this JSON object, and we have a number of getters to get values out. Notice that all getters return optional types, so it is up to the app developer to provide a default value.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let variables = nimbus.getVariables(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let action: String = variables.getString(&quot;settings-menu-item-action&quot;) ?? &quot;firefox://settings&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let title: String = variables.getText(&quot;settings-menu-item-title&quot;) ?? Strings.AppMenuSettingsTitle</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let icon: UIImage = variables.getImage(&quot;settings-menu-item-icon&quot;) ?? UIImage(named: &quot;icon-photon-gear&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let isEnabled: Bool = variables.getBool(&quot;settings-menu-item-enabled&quot;) ?? true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It is a similar story in Kotlin:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">val variables = nimbus.getVariables(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val action: String = variables.getString(&quot;settings-menu-item-action&quot;) ?: &quot;firefox://settings&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val title: String = variables.getText(&quot;settings-menu-item-title&quot;) ?: context.getString(R.string.app_menu_settings_title)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val icon: Drawable = variables.getDrawable(&quot;settings-menu-item-icon&quot;) ?: context.getDrawable(R.drawable.ic_settings)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val isEnabled: Bool = variables.getBool(&quot;settings-menu-item-enabled&quot;) ?? true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A few things to talk about here:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="fundamental-types-strings-int-bool"></a>Fundamental types: Strings, Int, Bool<a class="hash-link" href="#fundamental-types-strings-int-bool" title="Direct link to heading">#</a></h3><p><code>getString(key)</code>, <code>getBool(key)</code> and <code>getInt(key)</code> all return values as found in the JSON. If there is a disagreement about types, i.e. if the app is expecting a string, and the value in the JSON is an integer, the app gets <code>nil</code> or <code>null</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="everything-is-optional"></a>Everything is optional<a class="hash-link" href="#everything-is-optional" title="Direct link to heading">#</a></h3><p>If the app asks for a variable that is not specified in this particular experiment, then it gets back <code>nil</code> or <code>null</code>.</p><p>It is thus imperative that the app has a reasonable default. On the other hand, this allows us to have experiments which configure only small parts of a feature.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="text-resources"></a>Text resources<a class="hash-link" href="#text-resources" title="Direct link to heading">#</a></h3><p>In the example above, the title uses <code>getText()</code>. This gets a string value with <code>getString()</code>. The value is then used as a key to look up the app resource string.</p><p>For example, on Android: <code>getText(&quot;settings-menu-item-title&quot;)</code> may get a string from the JSON <code>&quot;app_menu_settings_title&quot;</code>, which is then resolves to <code>R.string.app_menu_settings_title</code> which is then used to look up the String in the <code>Resources</code>.</p><p>On iOS, <code>getText</code> uses a similar process via <code>LocalizedString</code> to look up the translated strings. You can specify the <code>tableName</code> as well as the <code>key</code> in the single value by joining it with a slash.</p><p>For example, <code>getText(&quot;settings-menu-item-title&quot;)</code> may get a string from the JSON <code>&quot;AppMenu/SettingsTitle&quot;</code> which uses <code>bundle.localizedString(&quot;SettingsTitle&quot;, tableName: &quot;AppMenu&quot;)</code> to look up a localized string. If the app doesn&#x27;t use <code>tableName</code>, then you can omit it: e.g. <code>AppMenu_SettingsTitle</code> would look for <code>NSLocalizedString(&quot;AppMenu_SettingsTitle&quot;)</code>.</p><p>If <code>getString()</code> returned a string, and the resource lookup didn&#x27;t succeed, <code>getText()</code> falls back to the string.</p><p>This means that you can use either pre-translated strings to try out experiments across locales, or target your experiment on a single language.</p><blockquote><p>üéõ Configuration</p><p>Resource lookup via <code>Bundle</code> and <code>Context</code> uses the objects passed to nimbus at construction time at app-startup. In Firefox for iOS and Fenix this is <code>Bundle.main</code> and <code>context.applicationContext</code> respectively.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="-image-resources"></a>üì∑ Image resources<a class="hash-link" href="#-image-resources" title="Direct link to heading">#</a></h3><p>In the example above, the <code>icon</code> uses <code>getImage()</code> and its Android analog <code>getDrawable()</code>. This gets a string value from the JSON with <code>getString()</code> and then uses that value to look up the pre-bundled resource.</p><p>For example on Android: <code>getDrawable(&quot;settings-menu-item-icon&quot;)</code> uses <code>getString(&quot;settings-menu-item-icon&quot;)</code> which might get the value <code>&quot;ic_settings&quot;</code> from JSON. This is then resolved to <code>R.drawable.ic_settings</code>, which is then resolved to <code>context.resources.getDrawable(R.drawable.ic_settings)</code>.</p><p>On iOS: <code>getImage(&quot;settings-menu-item-icon&quot;)</code> uses <code>getString(&quot;settings-menu-item-icon&quot;)</code> which might get the value <code>&quot;icon_photon_gear&quot;</code>, which is then used to get the named <code>UIImage</code> with <code>UIImage(named:in:)</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="making-json-more-manageable"></a>Making JSON more manageable<a class="hash-link" href="#making-json-more-manageable" title="Direct link to heading">#</a></h2><p>We focused on the settings menu item in the above example, as a way of making a small enough example to reason about in this documentation, but it made for some very long variable names. The <code>Variables</code> object has itself a <code>getVariables(key: String)</code> method to make navigating the JSON more easily. This in turn allows the JSON to be organized in different ways.</p><p>Zooming out of our example above, which had just one menu item: we can re-arrange the JSON to accommodate multiple menu items, with a simpler nested structure:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;bookmarks&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_bookmarks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;View Bookmarks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://bookmark_list&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;history&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_history&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;View History&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://history_list&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This might be accessed in Kotlin with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">val menuVariables = nimbus.getVariables(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var settingsItem = menuVariables.getVariables(&quot;settings&quot;).let { vars -&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val action: String = vars?.getString(&quot;action&quot;) ?: &quot;firefox://settings&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val title: String = vars?.getText(&quot;title&quot;) ?: context.getString(R.string.app_menu_settings_title)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val icon: Drawable = vars?.getDrawable(&quot;icon&quot;) ?: context.getDrawable(R.drawable.ic_settings)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MenuItem(icon, title, action)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In Swift:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let menuVariables = nimbus.getVariables(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let settingsItem = menuVariables.getVariables(&quot;settings&quot;) { vars -&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let action: String = vars?.getString(&quot;action&quot;) ?? &quot;firefox://settings&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let title: String = vars?.getText(&quot;title&quot;) ?? Strings.AppMenuSettingsTitle</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let icon: UIImage = vars?.getImage(&quot;icon&quot;) ?? UIImage(named: &quot;icon-photon-gear&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let isEnabled: Bool = vars?.getBool(&quot;enabled&quot;) ?? true</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MZMenuItem(icon: icon, title: title, action: action)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>üëã Information</p><p><code>variables.getVariables()</code> can be arbitrarily deep. <code>variables.getVariables()</code> returns an optional <code>Variables</code> object.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="structural-types"></a>Structural types<a class="hash-link" href="#structural-types" title="Direct link to heading">#</a></h3><p>Lists and dictionary types are supported for every type.</p><p>For example: <code>getStringList(key)</code> returns an list of <code>String</code>s (<code>[String]?</code> or <code>List&lt;String&gt;?</code>). <code>getIntMap(key)</code> returns a <code>[String: Int]?</code> or <code>Map&lt;String, Int&gt;?</code>. Getting a <code>Map</code> of anything will always have a key type <code>String</code>.</p><p>This includes nested variables and enums.</p><p>For example, we may have configured a feature to accept some JSON that may look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;ordering&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bookmarks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;history&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;items&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;settings&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://settings&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;bookmarks&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_bookmarks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;View Bookmarks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://bookmark_list&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;history&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_history&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;View History&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://history_list&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The application code to read that JSON now looks like this in Kotlin:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fun toMenuItem(vars: Variables): MenuItem? {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val action: String = vars?.getString(&quot;action&quot;) ?: return null</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val title: String = vars?.getText(&quot;title&quot;) ?: return null</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val icon: Drawable = vars?.getDrawable(&quot;icon&quot;) ?: return null</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return MenuItem(icon, title, action)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val menuVariables = nimbus.getVariables(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use the ordering from the experiment or the hardcoded version.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val ordering: List&lt;String&gt; = menuVariables.getStringList(&quot;ordering&quot;) ?: hardcodedOrdering</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Get a list of MenuItem items from the &quot;items&quot; object, using toMenuItem.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val experimentalItems: Map&lt;String, MenuItem&gt; = menuVariables.getVariablesMap(&quot;items&quot;, ::toMenuItem) ?: mapOf()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// use the ordering to lookup the menu items from the experiment or the hardcoded version.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val items: List&lt;MenuItem&gt; = ordering.mapNotNull { id -&gt; experimentalItems[id] ?: hardcodedItems[id] }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use the items to make the menu</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And in Swift:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">func toMenuItem(vars: Variables): MZMenuItem? {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    guard let action = vars.getString(&quot;action&quot;),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let title = vars.getText(&quot;title&quot;),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let icon = vars.getDrawable(&quot;icon&quot;) else {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return nil</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return MZMenuItem(icon: icon, title: title, action: action)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let menuVariables = nimbus.getVariables(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use the ordering from the experiment or the hardcoded version.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let ordering = menuVariables.getStringList(&quot;ordering&quot;) ?? hardcodedOrdering</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Get a list of MZMenuItem items from the &quot;items&quot; object, using toMenuItem.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let experimentalItems = menuVariables.getVariablesMap(&quot;items&quot;, transform: toMenuItem) ?? [:]()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// use the ordering to lookup the menu items from the experiment or the hardcoded version.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let items: [MZMenuItem] = ordering.compactMap { id in experimentalItems[id] ?? hardcodedItems[id] }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Use the items to make the menu</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Building the menu like this allows the experiment to add and remove menu items remotely, while still providing a default experience.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="enumerations-of-values"></a>Enumerations of values<a class="hash-link" href="#enumerations-of-values" title="Direct link to heading">#</a></h3><p>The above example leans quite heavily on <code>String</code>s. The code may be written in such a way that an <code>enum</code> would be more appropriate.</p><p>In this contrived example of a homescreen with different sections, we see some JSON with a list and a map. The items of the list correspond to the keys of the map.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;section-ordering&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;topSites&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highlights&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;collections&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;sections-rows&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;topSites&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;highlights&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;collections&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;recentlyViewed&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can represent these items in Kotlin as an enum.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum class SectionId {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    recentlyViewed,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    topSites,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    highlights,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    collections</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>üëã Information</p><p><code>enum</code> classes in Kotlin can be resolved only by their name, which cannot include hyphens.</p></blockquote><p>Also in Swift:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum SectionId: String {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case recentlyViewed</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case topSites</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case highlights</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case collections</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, when preparing our Home screen, we can get the list:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">val variables = nimbus.getVariables(&quot;home-screen&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val ordering: List&lt;SectionId&gt;? = variables.getEnumList(&quot;section-ordering&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val sectionsRows: Map&lt;SectionId, Int&gt;? = variables.getIntMap(&quot;sections-rows&quot;)?.mapKeysAsEnums()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and in Swift.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let variables = nimbus.getVariables(&quot;home-screen&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let ordering: [SectionId]? = variables.getEnumList(&quot;section-ordering&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let sectionRows: [SectionId: Int]? = variables.getIntMap(&quot;section-rows&quot;).compactMapKeysAsEnums()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="recording-exposure-events"></a>Recording exposure events<a class="hash-link" href="#recording-exposure-events" title="Direct link to heading">#</a></h2><blockquote><p>‚õÖÔ∏èüî¨üî≠ Enrollment versus Exposure</p><p>When a client is selected to take part in an experiment, they are <em>assigned</em> a branch. This is <em>enrollment</em>.</p><p>However, the user may not be <em>exposed</em> to the branch until sometime later. The exposure is the earliest moment that the user could be affected by the experimental treatment.</p><p>Nimbus records the enrollments and exposure events using Glean.</p><p>Enrollments are recorded at each app start-up, and exposure events each time an exposure happens.</p></blockquote><p>For experiments in Firefox for iOS and Android, enrollment happens shortly after app-startup.</p><p>In our example above, the app menu is constructed when a tab is open. The user is only exposed to the values of the JSON when they tap on the open-menu icon.</p><p>By default, exposure is recorded when <code>nimbus.getVariables(featureId: String)</code> is called. Whichever experiment the feature is enrolled in‚Äî always exactly zero or one‚Äî has an exposure event recorded.</p><p>A second, optional argument is allowed for this method <code>getVariables</code>, to change this default behavior.</p><p>Here, the menu is constructed with variables from Nimbus, but the user doesn&#x27;t see the menu until they open it.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">val menu = createMenu(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nimbus.getVariables(&quot;app-menu&quot;, sendExposureEvents = false)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val menuButton = Button(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    icon = R.drawable.ic_menu,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    onButtonPressed = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        nimbus.recordExposureEvent(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        show(menu)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is a caricature of the same code in Swift.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let menuSheet = createMenuSheet(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nimbus.getVariables(&quot;app-menu&quot;, sendExposureEvents: false)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let menuButton = UIButton()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">menuButton.addTarget(self, action: #selector(didOpenMenu), for: .touchUpInside)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func didOpenMenu() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let nimbus = Nimbus.shared</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nimbus.recordExposureEvent(&quot;app-menu&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    viewController.present(menuSheet, animated: true, completion: nil)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Nimbus will take care of finding out what experiment, if any, the user is enrolled in when using this feature.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="using-configurable-features-to-experiment-with-another"></a>Using configurable features to experiment with another<a class="hash-link" href="#using-configurable-features-to-experiment-with-another" title="Direct link to heading">#</a></h2><p>The feature itself may be configurable, but we don&#x27;t have to limit feature configuration to experiments <em>about that feature</em>.</p><p>We can imagine a world where we have multiple configurable features, say: an <code>app-menu</code>, <code>onboarding</code> and <code>newtab</code>. On each of these features we have a messaging surface, and we want to run an experiment to find which is the best surface to show the message about a behavior we wish to maximize: setting the browser to be the device default.</p><p>Q Can we configure an experiment to test each of the message on each of these messaging surfaces?</p><p>A This would be done with an experiment that has three branches, and each branch configures exactly one feature. The application code doesn&#x27;t have to know about the linkage between the features in this experiment, just get its configuration from Nimbus.</p><p>If a user is enrolled in that experiment, no other experiment is allowed to use the features involved.</p><p>We might also imagine a world where we have multiple features as before. Two different product teams are experimenting with two new capabilities of the app: both require onboarding instructions, one has an entry point via a app menu item, and the other has an entry point in the new tab screen.</p><p>If it was one product team where communication is high, perhaps they might run one experiment, with two treatment branches: one branch with configuration for the <code>onboarding</code> and <code>app-menu</code> features, and one branch with configuration for the <code>onboarding</code> and <code>new-tab</code> features.</p><p>Both teams require the <code>onboarding</code> feature. This allows each team to run their own experiments, which do not interfere with one another.</p><blockquote><p>‚õÖÔ∏èüî¨üî≠  Concept</p><p>While for any given user a feature may be involved in only one experiment, one experiment should be able to configure multiple features.</p></blockquote><p>Because both product teams&#x27; experiments require the <code>onboarding</code> experiment, no user will be involved in <em>both</em> experiments.</p><p>For such an experiment, an experiment would have two branches, each of which configure two features.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="Ô∏è-working-with-configurable-features"></a>üîß‚öôÔ∏è Working with configurable features<a class="hash-link" href="#Ô∏è-working-with-configurable-features" title="Direct link to heading">#</a></h2><p>Throughout the process of designing and building these configurable features, the feature variables have needed to be documented. At first, when the feature is being envisioned and designed, the variables should travel with the designs themselves.</p><p>When the feature is being implemented, these variables will begin to acquire concrete names, types and organization, which will be used extract JSON from the Nimbus SDK and configure the application features themselves. This documentation will begin to take shape and textual organization that travel in the app&#x27;s repository.</p><p>When the feature is being tested, QA testers are going to want to configure the features within bounds and tolerances set by the designs and the engineers.</p><p>Finally, when the feature is part of experiments, then the experiment owner, setting the branches in Experimenter needs to be able configure the branches with variables with spellings and organization that match the app implementation.</p><p>It&#x27;s strongly recommended that you keep a track of these identifiers and descriptions of the configurability of each of the features in at least one place. After implementing a configurable feature, it should probably live with the code repository, so it can versioned and tracked with the code.</p><blockquote><p>üëã Unimplemented</p><p>The Nimbus team has a few ideas about this, for documenting the features in an app in a machine readable format, tentatively called the Manifest. We&#x27;re thinking:</p><ol><li>generating code for app developers to use in app code<ul><li>managing defaults values</li><li>removing magic strings</li></ul></li><li>automating the registering of feature ids to Experimenter<ul><li>currently this needs an Experimenter reviewer or admin.</li></ul></li><li>generating Experimenter UI for experimenters to use in experiment branch design</li><li>generating on-device tools for feature testing, branch design and local development.</li></ol><p>We&#x27;re in the early stages of planning this, so would love to hear some feedback or ideas you may have.</p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/deep-dives/mobile/feature-variables-and-me.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/desktop-feature-api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Desktop Feature API (JS and C++)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/for-product"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Product Managers ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-this-document" class="table-of-contents__link">About this document</a></li><li><a href="#introduction" class="table-of-contents__link">Introduction</a><ul><li><a href="#fundamental-types-strings-int-bool" class="table-of-contents__link">Fundamental types: Strings, Int, Bool</a></li><li><a href="#everything-is-optional" class="table-of-contents__link">Everything is optional</a></li><li><a href="#text-resources" class="table-of-contents__link">Text resources</a></li><li><a href="#-image-resources" class="table-of-contents__link">üì∑ Image resources</a></li></ul></li><li><a href="#making-json-more-manageable" class="table-of-contents__link">Making JSON more manageable</a><ul><li><a href="#structural-types" class="table-of-contents__link">Structural types</a></li><li><a href="#enumerations-of-values" class="table-of-contents__link">Enumerations of values</a></li></ul></li><li><a href="#recording-exposure-events" class="table-of-contents__link">Recording exposure events</a></li><li><a href="#using-configurable-features-to-experiment-with-another" class="table-of-contents__link">Using configurable features to experiment with another</a></li><li><a href="#Ô∏è-working-with-configurable-features" class="table-of-contents__link">üîß‚öôÔ∏è Working with configurable features</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.04177c4c.js"></script>
<script src="/assets/js/main.b9c9d506.js"></script>
</body>
</html>